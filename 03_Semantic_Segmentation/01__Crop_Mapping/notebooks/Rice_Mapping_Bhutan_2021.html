<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Copyright 2024 NASA – SERVIR's Applied Deep Learning Handbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../04_Object_Detection/index.html" rel="next">
<link href="../../../02-Data-Preparation/index.html" rel="prev">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../02-Data-Preparation/index.html">Curriculum</a></li><li class="breadcrumb-item"><a href="../../../03_Semantic_Segmentation/01__Crop_Mapping/notebooks/Rice_Mapping_Bhutan_2021.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Semantic Segmentation (Crop Mapping)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">SERVIR’s Applied Deep Learning Handbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Curriculum</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../02-Data-Preparation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../03_Semantic_Segmentation/01__Crop_Mapping/notebooks/Rice_Mapping_Bhutan_2021.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Semantic Segmentation (Crop Mapping)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../04_Object_Detection/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Object Detection</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../05_Time_Series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../06_Eco_Process_Sim/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ecological Processes Simulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../07_Transfer_Learning/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Transfer Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../08_Fusion/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Fusion</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../09_Downscaling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Downscaling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../10_Future/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Future of Deep Learning and Foundational Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../11_Ethics/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Ethics and Artificial Intelligence</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../12_Conclusions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Conclusions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#semantic-segmentation-crop-mapping" id="toc-semantic-segmentation-crop-mapping" class="nav-link active" data-scroll-target="#semantic-segmentation-crop-mapping"><span class="header-section-number">3</span> Semantic Segmentation (Crop Mapping)</a>
  <ul class="collapse">
  <li><a href="#rice-mapping-in-bhutan-with-u-net-using-high-resolution-satellite-imagery" id="toc-rice-mapping-in-bhutan-with-u-net-using-high-resolution-satellite-imagery" class="nav-link" data-scroll-target="#rice-mapping-in-bhutan-with-u-net-using-high-resolution-satellite-imagery"><span class="header-section-number">3.1</span> Rice mapping in Bhutan with U-Net using high resolution satellite imagery</a></li>
  <li><a href="#setup-environment" id="toc-setup-environment" class="nav-link" data-scroll-target="#setup-environment"><span class="header-section-number">3.2</span> Setup environment</a>
  <ul class="collapse">
  <li><a href="#download-datasets" id="toc-download-datasets" class="nav-link" data-scroll-target="#download-datasets"><span class="header-section-number">3.2.1</span> Download datasets</a></li>
  <li><a href="#setup-config-file-variables" id="toc-setup-config-file-variables" class="nav-link" data-scroll-target="#setup-config-file-variables"><span class="header-section-number">3.2.2</span> Setup config file variables</a></li>
  <li><a href="#update-the-config-file-programtically" id="toc-update-the-config-file-programtically" class="nav-link" data-scroll-target="#update-the-config-file-programtically"><span class="header-section-number">3.2.3</span> Update the config file programtically</a></li>
  </ul></li>
  <li><a href="#u-net-model" id="toc-u-net-model" class="nav-link" data-scroll-target="#u-net-model"><span class="header-section-number">3.3</span> U-Net Model</a>
  <ul class="collapse">
  <li><a href="#load-config-file-variables" id="toc-load-config-file-variables" class="nav-link" data-scroll-target="#load-config-file-variables"><span class="header-section-number">3.3.1</span> Load config file variables</a></li>
  <li><a href="#load-modeltrainer-class" id="toc-load-modeltrainer-class" class="nav-link" data-scroll-target="#load-modeltrainer-class"><span class="header-section-number">3.3.2</span> Load <code>ModelTrainer</code> class</a></li>
  <li><a href="#train-and-save-u-net-model" id="toc-train-and-save-u-net-model" class="nav-link" data-scroll-target="#train-and-save-u-net-model"><span class="header-section-number">3.3.3</span> Train and Save U-Net model</a></li>
  <li><a href="#save-the-config-file" id="toc-save-the-config-file" class="nav-link" data-scroll-target="#save-the-config-file"><span class="header-section-number">3.3.4</span> Save the config file</a></li>
  <li><a href="#load-the-logs-files-via-tensorboard" id="toc-load-the-logs-files-via-tensorboard" class="nav-link" data-scroll-target="#load-the-logs-files-via-tensorboard"><span class="header-section-number">3.3.5</span> Load the logs files via TensorBoard</a></li>
  <li><a href="#load-the-saved-u-net-model" id="toc-load-the-saved-u-net-model" class="nav-link" data-scroll-target="#load-the-saved-u-net-model"><span class="header-section-number">3.3.6</span> Load the Saved U-Net Model</a></li>
  <li><a href="#inference-using-saved-u-net-model" id="toc-inference-using-saved-u-net-model" class="nav-link" data-scroll-target="#inference-using-saved-u-net-model"><span class="header-section-number">3.3.7</span> Inference using Saved U-Net Model</a></li>
  </ul></li>
  <li><a href="#dnn-model" id="toc-dnn-model" class="nav-link" data-scroll-target="#dnn-model"><span class="header-section-number">3.4</span> DNN Model</a>
  <ul class="collapse">
  <li><a href="#setup-any-changes-in-the-config-file-for-dnn-model" id="toc-setup-any-changes-in-the-config-file-for-dnn-model" class="nav-link" data-scroll-target="#setup-any-changes-in-the-config-file-for-dnn-model"><span class="header-section-number">3.4.1</span> Setup any changes in the config file for DNN Model</a></li>
  <li><a href="#update-the-config-file-programtically-1" id="toc-update-the-config-file-programtically-1" class="nav-link" data-scroll-target="#update-the-config-file-programtically-1"><span class="header-section-number">3.4.2</span> Update the config file programtically</a></li>
  <li><a href="#load-config-file-variables-for-dnn-model" id="toc-load-config-file-variables-for-dnn-model" class="nav-link" data-scroll-target="#load-config-file-variables-for-dnn-model"><span class="header-section-number">3.4.3</span> Load config file variables for DNN Model</a></li>
  <li><a href="#load-modeltrainer-class-1" id="toc-load-modeltrainer-class-1" class="nav-link" data-scroll-target="#load-modeltrainer-class-1"><span class="header-section-number">3.4.4</span> Load <code>ModelTrainer</code> class</a></li>
  <li><a href="#train-and-save-dnn-model" id="toc-train-and-save-dnn-model" class="nav-link" data-scroll-target="#train-and-save-dnn-model"><span class="header-section-number">3.4.5</span> Train and Save DNN model</a></li>
  <li><a href="#save-the-config-file-1" id="toc-save-the-config-file-1" class="nav-link" data-scroll-target="#save-the-config-file-1"><span class="header-section-number">3.4.6</span> Save the config file</a></li>
  <li><a href="#load-the-logs-files-via-tensorboard-1" id="toc-load-the-logs-files-via-tensorboard-1" class="nav-link" data-scroll-target="#load-the-logs-files-via-tensorboard-1"><span class="header-section-number">3.4.7</span> Load the logs files via TensorBoard</a></li>
  <li><a href="#load-the-saved-dnn-model" id="toc-load-the-saved-dnn-model" class="nav-link" data-scroll-target="#load-the-saved-dnn-model"><span class="header-section-number">3.4.8</span> Load the Saved DNN Model</a></li>
  <li><a href="#inference-using-saved-dnn-model" id="toc-inference-using-saved-dnn-model" class="nav-link" data-scroll-target="#inference-using-saved-dnn-model"><span class="header-section-number">3.4.9</span> Inference using Saved DNN Model</a></li>
  </ul></li>
  <li><a href="#independent-validation" id="toc-independent-validation" class="nav-link" data-scroll-target="#independent-validation"><span class="header-section-number">3.5</span> Independent Validation</a>
  <ul class="collapse">
  <li><a href="#update-the-config-file" id="toc-update-the-config-file" class="nav-link" data-scroll-target="#update-the-config-file"><span class="header-section-number">3.5.1</span> Update the config file</a></li>
  <li><a href="#load-config-file-variable" id="toc-load-config-file-variable" class="nav-link" data-scroll-target="#load-config-file-variable"><span class="header-section-number">3.5.2</span> Load config file variable</a></li>
  <li><a href="#import-earthengine-and-geemap-for-visualization" id="toc-import-earthengine-and-geemap-for-visualization" class="nav-link" data-scroll-target="#import-earthengine-and-geemap-for-visualization"><span class="header-section-number">3.5.3</span> Import earthengine and geemap for visualization</a></li>
  <li><a href="#class-information-and-masking" id="toc-class-information-and-masking" class="nav-link" data-scroll-target="#class-information-and-masking"><span class="header-section-number">3.5.4</span> Class Information and Masking</a></li>
  <li><a href="#model-u-net" id="toc-model-u-net" class="nav-link" data-scroll-target="#model-u-net"><span class="header-section-number">3.5.5</span> Model: U-Net</a></li>
  <li><a href="#model-dnn" id="toc-model-dnn" class="nav-link" data-scroll-target="#model-dnn"><span class="header-section-number">3.5.6</span> Model: DNN</a></li>
  </ul></li>
  <li><a href="#figures-and-plots" id="toc-figures-and-plots" class="nav-link" data-scroll-target="#figures-and-plots"><span class="header-section-number">3.6</span> Figures and Plots</a>
  <ul class="collapse">
  <li><a href="#training-and-validation-plot" id="toc-training-and-validation-plot" class="nav-link" data-scroll-target="#training-and-validation-plot"><span class="header-section-number">3.6.1</span> Training and Validation Plot</a></li>
  <li><a href="#probability-distribution-plot" id="toc-probability-distribution-plot" class="nav-link" data-scroll-target="#probability-distribution-plot"><span class="header-section-number">3.6.2</span> Probability Distribution Plot</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../02-Data-Preparation/index.html">Curriculum</a></li><li class="breadcrumb-item"><a href="../../../03_Semantic_Segmentation/01__Crop_Mapping/notebooks/Rice_Mapping_Bhutan_2021.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Semantic Segmentation (Crop Mapping)</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Copyright 2024 NASA</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cell-0" class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Licensed under the Apache License, Version 2.0 (the "License");</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># you may not use this file except in compliance with the License.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># You may obtain a copy of the License at</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     https://www.apache.org/licenses/LICENSE-2.0</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Unless required by applicable law or agreed to in writing, software</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># distributed under the License is distributed on an "AS IS" BASIS,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># See the License for the specific language governing permissions and</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># limitations under the License.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="semantic-segmentation-crop-mapping" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Semantic Segmentation (Crop Mapping)</h1>
<section id="rice-mapping-in-bhutan-with-u-net-using-high-resolution-satellite-imagery" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="rice-mapping-in-bhutan-with-u-net-using-high-resolution-satellite-imagery"><span class="header-section-number">3.1</span> Rice mapping in Bhutan with U-Net using high resolution satellite imagery</h2>
<table align="left">
<tbody><tr><td>
<a href="https://colab.research.google.com/github/SERVIR/servir-aces/blob/main/notebooks/aces_rice_classification_paro_2021.ipynb"> <img src="https://cloud.google.com/ml-engine/images/colab-logo-32px.png" alt="Colab logo"> Run in Colab </a>
</td>
<td>
<a href="https://github.com/SERVIR/servir-aces/blob/main/notebooks/aces_rice_classification_paro_2021.ipynb"> <img src="https://cloud.google.com/ml-engine/images/github-logo-32px.png" alt="GitHub logo"> View on GitHub </a>
</td></tr></tbody></table>
<p>This notebook is also available in this github repo: https://github.com/SERVIR/servir-aces. Navigate to the <code>notebooks</code> folder.</p>
</section>
<section id="setup-environment" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="setup-environment"><span class="header-section-number">3.2</span> Setup environment</h2>
<div id="cell-4" class="cell" data-outputid="8b3da502-46cf-4613-c619-42e640f5105a" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">"/content/drive"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-outputid="78155889-e4cd-48f0-fe73-7be89609deaa" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !pip install servir-aces</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Collecting servir-aces
  Downloading servir_aces-0.0.14-py2.py3-none-any.whl (32 kB)
Requirement already satisfied: numpy in /usr/local/lib/python3.10/dist-packages (from servir-aces) (1.25.2)
Requirement already satisfied: tensorflow&gt;=2.9.3 in /usr/local/lib/python3.10/dist-packages (from servir-aces) (2.15.0)
Requirement already satisfied: earthengine-api in /usr/local/lib/python3.10/dist-packages (from servir-aces) (0.1.399)
Collecting python-dotenv&gt;=1.0.0 (from servir-aces)
  Downloading python_dotenv-1.0.1-py3-none-any.whl (19 kB)
Requirement already satisfied: matplotlib in /usr/local/lib/python3.10/dist-packages (from servir-aces) (3.7.1)
Requirement already satisfied: absl-py&gt;=1.0.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (1.4.0)
Requirement already satisfied: astunparse&gt;=1.6.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (1.6.3)
Requirement already satisfied: flatbuffers&gt;=23.5.26 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (24.3.25)
Requirement already satisfied: gast!=0.5.0,!=0.5.1,!=0.5.2,&gt;=0.2.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (0.5.4)
Requirement already satisfied: google-pasta&gt;=0.1.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (0.2.0)
Requirement already satisfied: h5py&gt;=2.9.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (3.9.0)
Requirement already satisfied: libclang&gt;=13.0.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (18.1.1)
Requirement already satisfied: ml-dtypes~=0.2.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (0.2.0)
Requirement already satisfied: opt-einsum&gt;=2.3.2 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (3.3.0)
Requirement already satisfied: packaging in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (24.0)
Requirement already satisfied: protobuf!=4.21.0,!=4.21.1,!=4.21.2,!=4.21.3,!=4.21.4,!=4.21.5,&lt;5.0.0dev,&gt;=3.20.3 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (3.20.3)
Requirement already satisfied: setuptools in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (67.7.2)
Requirement already satisfied: six&gt;=1.12.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (1.16.0)
Requirement already satisfied: termcolor&gt;=1.1.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (2.4.0)
Requirement already satisfied: typing-extensions&gt;=3.6.6 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (4.11.0)
Requirement already satisfied: wrapt&lt;1.15,&gt;=1.11.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (1.14.1)
Requirement already satisfied: tensorflow-io-gcs-filesystem&gt;=0.23.1 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (0.36.0)
Requirement already satisfied: grpcio&lt;2.0,&gt;=1.24.3 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (1.62.2)
Requirement already satisfied: tensorboard&lt;2.16,&gt;=2.15 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (2.15.2)
Requirement already satisfied: tensorflow-estimator&lt;2.16,&gt;=2.15.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (2.15.0)
Requirement already satisfied: keras&lt;2.16,&gt;=2.15.0 in /usr/local/lib/python3.10/dist-packages (from tensorflow&gt;=2.9.3-&gt;servir-aces) (2.15.0)
Requirement already satisfied: google-cloud-storage in /usr/local/lib/python3.10/dist-packages (from earthengine-api-&gt;servir-aces) (2.8.0)
Requirement already satisfied: google-api-python-client&gt;=1.12.1 in /usr/local/lib/python3.10/dist-packages (from earthengine-api-&gt;servir-aces) (2.84.0)
Requirement already satisfied: google-auth&gt;=1.4.1 in /usr/local/lib/python3.10/dist-packages (from earthengine-api-&gt;servir-aces) (2.27.0)
Requirement already satisfied: google-auth-httplib2&gt;=0.0.3 in /usr/local/lib/python3.10/dist-packages (from earthengine-api-&gt;servir-aces) (0.1.1)
Requirement already satisfied: httplib2&lt;1dev,&gt;=0.9.2 in /usr/local/lib/python3.10/dist-packages (from earthengine-api-&gt;servir-aces) (0.22.0)
Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (from earthengine-api-&gt;servir-aces) (2.31.0)
Requirement already satisfied: contourpy&gt;=1.0.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;servir-aces) (1.2.1)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;servir-aces) (0.12.1)
Requirement already satisfied: fonttools&gt;=4.22.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;servir-aces) (4.51.0)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;servir-aces) (1.4.5)
Requirement already satisfied: pillow&gt;=6.2.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;servir-aces) (9.4.0)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;servir-aces) (3.1.2)
Requirement already satisfied: python-dateutil&gt;=2.7 in /usr/local/lib/python3.10/dist-packages (from matplotlib-&gt;servir-aces) (2.8.2)
Requirement already satisfied: wheel&lt;1.0,&gt;=0.23.0 in /usr/local/lib/python3.10/dist-packages (from astunparse&gt;=1.6.0-&gt;tensorflow&gt;=2.9.3-&gt;servir-aces) (0.43.0)
Requirement already satisfied: google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0dev,&gt;=1.31.5 in /usr/local/lib/python3.10/dist-packages (from google-api-python-client&gt;=1.12.1-&gt;earthengine-api-&gt;servir-aces) (2.11.1)
Requirement already satisfied: uritemplate&lt;5,&gt;=3.0.1 in /usr/local/lib/python3.10/dist-packages (from google-api-python-client&gt;=1.12.1-&gt;earthengine-api-&gt;servir-aces) (4.1.1)
Requirement already satisfied: cachetools&lt;6.0,&gt;=2.0.0 in /usr/local/lib/python3.10/dist-packages (from google-auth&gt;=1.4.1-&gt;earthengine-api-&gt;servir-aces) (5.3.3)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in /usr/local/lib/python3.10/dist-packages (from google-auth&gt;=1.4.1-&gt;earthengine-api-&gt;servir-aces) (0.4.0)
Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in /usr/local/lib/python3.10/dist-packages (from google-auth&gt;=1.4.1-&gt;earthengine-api-&gt;servir-aces) (4.9)
Requirement already satisfied: google-auth-oauthlib&lt;2,&gt;=0.5 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow&gt;=2.9.3-&gt;servir-aces) (1.2.0)
Requirement already satisfied: markdown&gt;=2.6.8 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow&gt;=2.9.3-&gt;servir-aces) (3.6)
Requirement already satisfied: tensorboard-data-server&lt;0.8.0,&gt;=0.7.0 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow&gt;=2.9.3-&gt;servir-aces) (0.7.2)
Requirement already satisfied: werkzeug&gt;=1.0.1 in /usr/local/lib/python3.10/dist-packages (from tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow&gt;=2.9.3-&gt;servir-aces) (3.0.2)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /usr/local/lib/python3.10/dist-packages (from requests-&gt;earthengine-api-&gt;servir-aces) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/local/lib/python3.10/dist-packages (from requests-&gt;earthengine-api-&gt;servir-aces) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests-&gt;earthengine-api-&gt;servir-aces) (2.0.7)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests-&gt;earthengine-api-&gt;servir-aces) (2024.2.2)
Requirement already satisfied: google-cloud-core&lt;3.0dev,&gt;=2.3.0 in /usr/local/lib/python3.10/dist-packages (from google-cloud-storage-&gt;earthengine-api-&gt;servir-aces) (2.3.3)
Requirement already satisfied: google-resumable-media&gt;=2.3.2 in /usr/local/lib/python3.10/dist-packages (from google-cloud-storage-&gt;earthengine-api-&gt;servir-aces) (2.7.0)
Requirement already satisfied: googleapis-common-protos&lt;2.0.dev0,&gt;=1.56.2 in /usr/local/lib/python3.10/dist-packages (from google-api-core!=2.0.*,!=2.1.*,!=2.2.*,!=2.3.0,&lt;3.0.0dev,&gt;=1.31.5-&gt;google-api-python-client&gt;=1.12.1-&gt;earthengine-api-&gt;servir-aces) (1.63.0)
Requirement already satisfied: requests-oauthlib&gt;=0.7.0 in /usr/local/lib/python3.10/dist-packages (from google-auth-oauthlib&lt;2,&gt;=0.5-&gt;tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow&gt;=2.9.3-&gt;servir-aces) (1.3.1)
Requirement already satisfied: google-crc32c&lt;2.0dev,&gt;=1.0 in /usr/local/lib/python3.10/dist-packages (from google-resumable-media&gt;=2.3.2-&gt;google-cloud-storage-&gt;earthengine-api-&gt;servir-aces) (1.5.0)
Requirement already satisfied: pyasn1&lt;0.7.0,&gt;=0.4.6 in /usr/local/lib/python3.10/dist-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth&gt;=1.4.1-&gt;earthengine-api-&gt;servir-aces) (0.6.0)
Requirement already satisfied: MarkupSafe&gt;=2.1.1 in /usr/local/lib/python3.10/dist-packages (from werkzeug&gt;=1.0.1-&gt;tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow&gt;=2.9.3-&gt;servir-aces) (2.1.5)
Requirement already satisfied: oauthlib&gt;=3.0.0 in /usr/local/lib/python3.10/dist-packages (from requests-oauthlib&gt;=0.7.0-&gt;google-auth-oauthlib&lt;2,&gt;=0.5-&gt;tensorboard&lt;2.16,&gt;=2.15-&gt;tensorflow&gt;=2.9.3-&gt;servir-aces) (3.2.2)
Installing collected packages: python-dotenv, servir-aces
Successfully installed python-dotenv-1.0.1 servir-aces-0.0.14</code></pre>
</div>
</div>
<div id="cell-6" class="cell" data-outputid="c2b3c329-2cd5-4072-95fa-88faf5893ade" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># !git clone https://github.com/SERVIR/servir-aces</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cloning into 'servir-aces'...
remote: Enumerating objects: 740, done.
remote: Counting objects: 100% (116/116), done.
remote: Compressing objects: 100% (78/78), done.
remote: Total 740 (delta 46), reused 68 (delta 38), pack-reused 624
Receiving objects: 100% (740/740), 5.07 MiB | 16.12 MiB/s, done.
Resolving deltas: 100% (468/468), done.</code></pre>
</div>
</div>
<section id="download-datasets" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="download-datasets"><span class="header-section-number">3.2.1</span> Download datasets</h3>
<p>For this chapter, we have already prepared and exported the training datasets. They can be found at the google cloud storage and we will use <code>gsutil</code> to get the dataset in our workspace. The dataset has <code>training</code>, <code>testing</code>, and <code>validation</code> subdirectory. Let’s start by downloading these datasets in our workspace.</p>
<p>If you’re looking to produce your own datasets, you can follow this <a href="https://colab.research.google.com/drive/1LCFLeSCu969wIW8TD68-j4hfIu7WiRIK?usp=sharing">notebook</a> which was used to produce these training, testing, and validation datasets provided in this notebook.</p>
<div id="cell-10" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mkdir <span class="op">-</span>p content<span class="op">/</span>datasets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell" data-outputid="e9dcc757-f3f9-4d2b-9ba4-6387d450b5bf" data-execution_count="11">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>gsutil <span class="op">-</span>m cp <span class="op">-</span>r gs:<span class="op">//</span>dl<span class="op">-</span>book<span class="op">/</span>chapter<span class="op">-</span><span class="dv">1</span> content<span class="op">/</span>datasets<span class="op">/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>If you experience problems with multiprocessing on MacOS, they might be related to https://bugs.python.org/issue33725. You can disable multiprocessing by editing your .boto config or by adding the following flag to your command: `-o "GSUtil:parallel_process_count=1"`. Note that multithreading is still available even if you disable multiprocessing.

Copying gs://dl-book/chapter-1/.DS_Store...
Copying gs://dl-book/chapter-1/dnn_planet_wo_indices/testing/testing.tfrecord.gz...
Copying gs://dl-book/chapter-1/dnn_planet_wo_indices/training/training.tfrecord.gz...
Copying gs://dl-book/chapter-1/dnn_planet_wo_indices/validation/validation.tfrecord.gz...
Copying gs://dl-book/chapter-1/images/image_202100000.tfrecord.gz...            
Copying gs://dl-book/chapter-1/images/image_202100001.tfrecord.gz...            
Copying gs://dl-book/chapter-1/images/image_202100002.tfrecord.gz...            
Copying gs://dl-book/chapter-1/images/image_202100003.tfrecord.gz...            
Copying gs://dl-book/chapter-1/models/dnn_v1/config.env...                      
Copying gs://dl-book/chapter-1/images/image_202100004.tfrecord.gz...            
Copying gs://dl-book/chapter-1/images/image_202100005.tfrecord.gz...            
Copying gs://dl-book/chapter-1/images/image_2021mixer.json...                   
Copying gs://dl-book/chapter-1/models/dnn_v1/aces/keras_metadata.pb...          
Copying gs://dl-book/chapter-1/models/dnn_v1/aces/fingerprint.pb...
Copying gs://dl-book/chapter-1/models/dnn_v1/aces/saved_model.pb...             
Copying gs://dl-book/chapter-1/models/dnn_v1/aces/variables/variables.data-00000-of-00001...
Copying gs://dl-book/chapter-1/models/dnn_v1/aces/variables/variables.index...
Copying gs://dl-book/chapter-1/models/dnn_v1/config.json...                     
Copying gs://dl-book/chapter-1/models/dnn_v1/evaluation.txt...                  
Copying gs://dl-book/chapter-1/models/dnn_v1/logs/train/events.out.tfevents.1713307528.b5c4c6e407b9.190.2.v2...
Copying gs://dl-book/chapter-1/models/dnn_v1/logs/validation/events.out.tfevents.1713307537.b5c4c6e407b9.190.3.v2...
Copying gs://dl-book/chapter-1/models/dnn_v1/model.png...
Copying gs://dl-book/chapter-1/models/dnn_v1/model.txt...                       
Copying gs://dl-book/chapter-1/models/dnn_v1/modelCheckpoint/fingerprint.pb...  
Copying gs://dl-book/chapter-1/models/dnn_v1/modelCheckpoint/variables/variables.data-00000-of-00001...
Copying gs://dl-book/chapter-1/models/dnn_v1/modelCheckpoint/keras_metadata.pb...
Copying gs://dl-book/chapter-1/models/unet_v1/aces/fingerprint.pb...            
Copying gs://dl-book/chapter-1/models/unet_v1/aces/keras_metadata.pb...         
Copying gs://dl-book/chapter-1/models/dnn_v1/model.pkl...                       
Copying gs://dl-book/chapter-1/models/dnn_v1/modelCheckpoint/variables/variables.index...
Copying gs://dl-book/chapter-1/models/dnn_v1/parameters.txt...                  
Copying gs://dl-book/chapter-1/models/dnn_v1/prediction/prediction_dnn_v1.TFRecord...
Copying gs://dl-book/chapter-1/models/unet_v1/model.pkl...
Copying gs://dl-book/chapter-1/models/dnn_v1/trained-model/fingerprint.pb...
Copying gs://dl-book/chapter-1/models/dnn_v1/modelCheckpoint/saved_model.pb...  
==&gt; NOTE: You are downloading one or more large file(s), which would            
run significantly faster if you enabled sliced object downloads. This
feature is enabled by default but requires that compiled crcmod be
installed (see "gsutil help crcmod").

Copying gs://dl-book/chapter-1/models/unet_v1/aces/saved_model.pb...
Copying gs://dl-book/chapter-1/models/dnn_v1/trained-model/keras_metadata.pb... 
Copying gs://dl-book/chapter-1/models/dnn_v1/trained-model/saved_model.pb...    
Copying gs://dl-book/chapter-1/models/dnn_v1/trained-model/variables/variables.index...
Copying gs://dl-book/chapter-1/models/dnn_v1/trained-model/variables/variables.data-00000-of-00001...
Copying gs://dl-book/chapter-1/models/dnn_v1/training.png...                    
Copying gs://dl-book/chapter-1/models/unet_v1/aces/variables/variables.data-00000-of-00001...
Copying gs://dl-book/chapter-1/models/unet_v1/model.png...                      
Copying gs://dl-book/chapter-1/models/unet_v1/logs/train/events.out.tfevents.1713299324.b5c4c6e407b9.190.0.v2...
Copying gs://dl-book/chapter-1/models/unet_v1/config.env...                     
Copying gs://dl-book/chapter-1/models/unet_v1/evaluation.txt...
Copying gs://dl-book/chapter-1/models/unet_v1/config.json...                    
Copying gs://dl-book/chapter-1/models/unet_v1/model.txt...                      
Copying gs://dl-book/chapter-1/models/unet_v1/logs/validation/events.out.tfevents.1713299558.b5c4c6e407b9.190.1.v2...
Copying gs://dl-book/chapter-1/models/unet_v1/aces/variables/variables.index... 
Copying gs://dl-book/chapter-1/models/unet_v1/modelCheckpoint/fingerprint.pb... 
Copying gs://dl-book/chapter-1/models/unet_v1/modelCheckpoint/keras_metadata.pb...
Copying gs://dl-book/chapter-1/models/unet_v1/modelCheckpoint/saved_model.pb... 
Copying gs://dl-book/chapter-1/models/unet_v1/modelCheckpoint/variables/variables.data-00000-of-00001...
Copying gs://dl-book/chapter-1/models/unet_v1/modelCheckpoint/variables/variables.index...
Copying gs://dl-book/chapter-1/models/unet_v1/prediction/prediction_unet_v1.TFRecord...
Copying gs://dl-book/chapter-1/models/unet_v1/parameters.txt...
Copying gs://dl-book/chapter-1/models/unet_v1/trained-model/fingerprint.pb...   
Copying gs://dl-book/chapter-1/models/unet_v1/trained-model/keras_metadata.pb...
Copying gs://dl-book/chapter-1/models/unet_v1/trained-model/saved_model.pb...   
Copying gs://dl-book/chapter-1/models/unet_v1/trained-model/variables/variables.data-00000-of-00001...
Copying gs://dl-book/chapter-1/models/unet_v1/trained-model/variables/variables.index...
Copying gs://dl-book/chapter-1/models/unet_v1/training.png...                   
Copying gs://dl-book/chapter-1/prediction/prediction_dnn_v1.TFRecord...         
Copying gs://dl-book/chapter-1/prediction/prediction_unet_v1.TFRecord...        
Copying gs://dl-book/chapter-1/training_data/testing_10/testing__256x256-00000-of-00008.tfrecord.gz...
Copying gs://dl-book/chapter-1/training_data/testing_10/testing__256x256-00001-of-00008.tfrecord.gz...
Copying gs://dl-book/chapter-1/training_data/testing_10/testing__256x256-00003-of-00008.tfrecord.gz...
Copying gs://dl-book/chapter-1/training_data/testing_10/testing__256x256-00002-of-00008.tfrecord.gz...
Copying gs://dl-book/chapter-1/training_data/testing_10/testing__256x256-00004-of-00008.tfrecord.gz...
Copying gs://dl-book/chapter-1/training_data/testing_10/testing__256x256-00005-of-00008.tfrecord.gz...
Copying gs://dl-book/chapter-1/training_data/testing_10/testing__256x256-00006-of-00008.tfrecord.gz...
Copying gs://dl-book/chapter-1/training_data/testing_10/testing__256x256-00007-of-00008.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00000-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00001-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00002-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00003-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00004-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00005-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00006-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00007-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00008-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00009-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00010-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00011-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00012-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00013-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00014-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00015-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00016-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00017-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00018-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00019-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00020-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00021-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00022-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00023-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00024-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00025-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00026-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00027-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00028-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00029-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00030-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00031-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00032-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00033-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00034-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00035-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00036-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/testing/testing-00037-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00000-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00001-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00002-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00003-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00004-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00005-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00006-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00007-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00008-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00009-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00010-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00011-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00012-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00013-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00014-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00015-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00016-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00017-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00018-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00019-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00020-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00021-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00022-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00023-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00024-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00025-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00026-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00027-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00028-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00029-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00030-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00031-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00032-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00033-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00034-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00035-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00036-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/training/training-00037-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00000-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00001-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00002-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00003-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00004-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00005-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00006-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00007-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00008-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00009-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00010-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00011-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00012-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00013-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00014-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00015-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00016-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00017-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00018-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00019-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00020-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00021-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00022-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00023-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00024-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00025-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00026-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00027-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00028-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00029-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00030-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00031-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00032-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00033-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00034-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00035-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00036-of-00038.tfrecord.gz...
Copying gs://dl-book/chapter-1/unet_256x256_planet_wo_indices/validation/validation-00037-of-00038.tfrecord.gz...
/ [187/192 files][ 16.3 GiB/ 16.3 GiB]  99% Done  43.1 MiB/s ETA 00:00:00       </code></pre>
</div>
</div>
</section>
<section id="setup-config-file-variables" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="setup-config-file-variables"><span class="header-section-number">3.2.2</span> Setup config file variables</h3>
<p>Now the repo is downloaded. We will create an environment file file to place point to our training data and customize parameters for the model. To do this, we make a copy of the <code>.env.example</code> file provided.</p>
<p>Under the hood, all the configuration provided via the environment file are parsed as a config object and can be accessed programatically.</p>
<p>Note current version does not expose all the model intracacies through the environment file but future version may include those depending on the need.</p>
<div id="cell-14" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cp servir<span class="op">-</span>aces<span class="op">/</span>.env.example servir<span class="op">-</span>aces<span class="op">/</span>config.env</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Okay, now we have the <code>config.env</code> file, we will use this to provide our environments and parameters.</p>
<p>Note there are several parameters that can be changed. Let’s start by changing the <code>BASEDIR</code> and <code>OUTPUT_DIR</code> as below.</p>
<pre><code>BASEDIR = "/content/"
OUTPUT_DIR = "/content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output"</code></pre>
<p>We will start by training a <a href="https://insert-citation-here">U-Net</a> model using the <code>dl-book/chapter-1/unet_256x256_planet_wo_indices</code> dataset inside the <code>dataset</code> folder for this exercise. Let’s go ahead and change our DATADIR in the <code>config.env</code> file as below.</p>
<pre><code>DATADIR = "datasets/unet_256x256_planet_wo_indices"</code></pre>
<p>These datasets have RGBN from Planetscope mosiac. Since we are trying to map the rice fields, we use growing season and pre-growing season information. Thus, we have 8 optical bands, namely <code>red_before</code>, <code>green_before</code>, <code>blue_before</code>, <code>nir_before</code>, <code>red_during</code>, <code>green_during</code>, <code>blue_during</code>, and <code>nir_during</code>. In adidition, you can use <code>USE_ELEVATION</code> and <code>USE_S1</code> config to include the topographic and radar information. Since this datasets have toppgraphic and radar features, so we won’t be settting these config values. Similarly, these datasets are tiled to 256x256 pixels, so let’s also change that.</p>
<pre><code># For model training, USE_ELEVATION extends FEATURES with "elevation" &amp; "slope"
# USE_S1 extends FEATURES with "vv_asc_before", "vh_asc_before", "vv_asc_during", "vh_asc_during",
# "vv_desc_before", "vh_desc_before", "vv_desc_during", "vh_desc_during"
# In case these are not useful and you have other bands in your training data, you can do set
# USE_ELEVATION and USE_S1 to False and update FEATURES to include needed bands
USE_ELEVATION = False
USE_S1 = False

PATCH_SHAPE = (256, 256)</code></pre>
<p>Next, we need to calculate the size of the traiing, testing and validation dataset. For this, we know our size before hand. But <code>aces</code> also provides handful of functions that we can use to calculate this. See this <a href="https://colab.research.google.com/drive/12WgDI3ptFZHmcfOw89fmPSsDwO-sXIUH?usp=sharing">notebook</a> to learn more about how to do it. We will also change the <code>BATCH_SIZE</code> to 32; if you have larger memory available, you can increase the <code>BATCH_SIZE</code>. You can run for longer <code>EPOCHS</code> by changing the <code>EPOCHS</code> paramter; we will keep it to 5 for now.</p>
<pre><code># Sizes of the training and evaluation datasets.
TRAIN_SIZE = 8531
TEST_SIZE = 1222
VAL_SIZE = 2404
BATCH_SIZE = 32
EPOCHS = 30</code></pre>
</section>
<section id="update-the-config-file-programtically" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="update-the-config-file-programtically"><span class="header-section-number">3.2.3</span> Update the config file programtically</h3>
<p>We can also make a dictionary so we can change these config settings programatically.</p>
<div id="cell-21" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>BASEDIR   <span class="op">=</span> <span class="st">"/content/"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>OUTPUT_DIR <span class="op">=</span> <span class="st">"/content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>DATADIR <span class="op">=</span> <span class="st">"datasets/unet_256x256_planet_wo_indices"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># PATCH_SHAPE, USE_ELEVATION, USE_S1, TRAIN_SIZE, TEST_SIZE, VAL_SIZE</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># BATCH_SIZE, EPOCHS are converted to their appropriate type.</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>USE_ELEVATION <span class="op">=</span> <span class="st">"False"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>USE_S1 <span class="op">=</span> <span class="st">"False"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>PATCH_SHAPE <span class="op">=</span> <span class="st">"(256, 256)"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>TRAIN_SIZE <span class="op">=</span> <span class="st">"8531"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>TEST_SIZE <span class="op">=</span> <span class="st">"1222"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>VAL_SIZE <span class="op">=</span> <span class="st">"2404"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="st">"32"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="st">"30"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>MODEL_DIR_NAME <span class="op">=</span> <span class="st">"unet_v1"</span> <span class="co"># @param {type:"string"}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>unet_config_settings <span class="op">=</span> {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BASEDIR"</span> : BASEDIR,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OUTPUT_DIR"</span>: OUTPUT_DIR,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DATADIR"</span>: DATADIR,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"USE_ELEVATION"</span>: USE_ELEVATION,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"USE_S1"</span>: USE_S1,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PATCH_SHAPE"</span>: PATCH_SHAPE,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TRAIN_SIZE"</span>: TRAIN_SIZE,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TEST_SIZE"</span>: TEST_SIZE,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"VAL_SIZE"</span>: VAL_SIZE,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BATCH_SIZE"</span>: BATCH_SIZE,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPOCHS"</span>: EPOCHS,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MODEL_DIR_NAME"</span>: MODEL_DIR_NAME,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-23" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dotenv</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>config_file <span class="op">=</span> <span class="st">"servir-aces/config.env"</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> config_key <span class="kw">in</span> unet_config_settings:</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    dotenv.set_key(dotenv_path<span class="op">=</span>config_file,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                   key_to_set<span class="op">=</span>config_key,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                   value_to_set<span class="op">=</span>unet_config_settings[config_key]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="u-net-model" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="u-net-model"><span class="header-section-number">3.3</span> U-Net Model</h2>
<section id="load-config-file-variables" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="load-config-file-variables"><span class="header-section-number">3.3.1</span> Load config file variables</h3>
<div id="cell-26" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> aces <span class="im">import</span> Config, DataProcessor, ModelTrainer, EEUtils</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s load our config file through the <code>Config</code> class.</p>
<div id="cell-28" class="cell" data-outputid="25e08952-d33c-4f37-b6e7-d0c605c10b17" data-execution_count="10">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>unet_config <span class="op">=</span> Config(config_file<span class="op">=</span>config_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BASEDIR: /content
DATADIR: /content/datasets/unet_256x256_planet_wo_indices
using features: ['red_before', 'green_before', 'blue_before', 'nir_before', 'red_during', 'green_during', 'blue_during', 'nir_during']
using labels: ['class']</code></pre>
</div>
</div>
<p>Most of the config in the <code>config.env</code> is now available via the config instance. Let’s check few of them here.</p>
<div id="cell-30" class="cell" data-outputid="cfdd6f70-f82d-4af4-b54e-abb67038c02e" data-execution_count="11">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>unet_config.TRAINING_DIR, unet_config.OUTPUT_DIR, unet_config.BATCH_SIZE, unet_config.TRAIN_SIZE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>(PosixPath('/content/datasets/unet_256x256_planet_wo_indices/training'),
 PosixPath('/content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output'),
 32,
 8531)</code></pre>
</div>
</div>
</section>
<section id="load-modeltrainer-class" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="load-modeltrainer-class"><span class="header-section-number">3.3.2</span> Load <code>ModelTrainer</code> class</h3>
<p>Next, let’s make an instance of the <code>ModelTrainer</code> object. The <code>ModelTrainer</code> class provides various tools for training, buidling, compiling, and running specified deep learning models.</p>
<div id="cell-33" class="cell" data-outputid="bafab6c8-72bc-41a7-f8bb-516a423a9e19" data-execution_count="12">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>unet_model_trainer <span class="op">=</span> ModelTrainer(unet_config, seed<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using seed: 42</code></pre>
</div>
</div>
</section>
<section id="train-and-save-u-net-model" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="train-and-save-u-net-model"><span class="header-section-number">3.3.3</span> Train and Save U-Net model</h3>
<p><a href="https://servir.github.io/servir-aces/model_trainer/"><code>ModelTrainer</code></a> class provides various functionality. We will use <code>train_model</code> function that helps to train the model using the provided configuration settings.</p>
<p>This method performs the following steps: - Configures memory growth for TensorFlow. - Creates TensorFlow datasets for training, testing, and validation. - Builds and compiles the model. - Prepares the output directory for saving models and results. - Starts the training process. - Evaluates and prints validation metrics. - Saves training parameters, plots, and models.</p>
<div id="cell-36" class="cell" data-outputid="199f9beb-c7e0-4b03-8216-a77c6412a4d5">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>unet_model_trainer.train_model()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>****************************************************************************
****************************** Clear Session... ****************************
****************************************************************************
****************************** Configure memory growth... ************************
 &gt; Found 1 GPUs
****************************************************************************
****************************** creating datasets... ************************
Loading dataset from /content/datasets/unet_256x256_planet_wo_indices/training/*
randomly transforming data
Loading dataset from /content/datasets/unet_256x256_planet_wo_indices/validation/*
Loading dataset from /content/datasets/unet_256x256_planet_wo_indices/testing/*
Printing dataset info:
Training
inputs: float32 (32, 256, 256, 8)
tf.Tensor(
[[[[0.073075 0.063275 0.0411   ... 0.050625 0.0274   0.23925 ]
   [0.084775 0.067375 0.047025 ... 0.057675 0.032075 0.242375]
   [0.083625 0.068575 0.045075 ... 0.059275 0.0332   0.2409  ]
   ...
   [0.0702   0.06825  0.04495  ... 0.055025 0.028325 0.26305 ]
   [0.064475 0.066    0.043575 ... 0.0524   0.027075 0.26705 ]
   [0.0676   0.06355  0.04535  ... 0.05375  0.02875  0.263275]]

  [[0.071475 0.062225 0.0388   ... 0.0496   0.025375 0.24155 ]
   [0.07815  0.065025 0.044225 ... 0.0545   0.02905  0.24175 ]
   [0.086025 0.069125 0.046175 ... 0.05855  0.0326   0.2355  ]
   ...
   [0.060775 0.0627   0.041875 ... 0.051575 0.029725 0.267475]
   [0.061375 0.06225  0.04225  ... 0.0513   0.02685  0.268375]
   [0.06845  0.064075 0.043925 ... 0.052925 0.028575 0.267975]]

  [[0.0677   0.0605   0.038625 ... 0.04835  0.024825 0.236075]
   [0.078375 0.0629   0.04215  ... 0.0524   0.02855  0.237375]
   [0.0857   0.065725 0.04635  ... 0.05705  0.030975 0.235375]
   ...
   [0.07     0.062775 0.04485  ... 0.053425 0.0292   0.27015 ]
   [0.0607   0.060675 0.041175 ... 0.053075 0.026275 0.27025 ]
   [0.068    0.0667   0.045375 ... 0.055475 0.029375 0.262725]]

  ...

  [[0.083525 0.06785  0.044125 ... 0.06365  0.0331   0.234825]
   [0.097825 0.07235  0.047925 ... 0.06675  0.03365  0.2363  ]
   [0.1092   0.082125 0.05385  ... 0.072125 0.036225 0.2486  ]
   ...
   [0.08935  0.088725 0.067575 ... 0.079675 0.042425 0.38085 ]
   [0.093725 0.0875   0.06355  ... 0.07565  0.04185  0.344525]
   [0.0937   0.089675 0.066775 ... 0.07465  0.043025 0.330925]]

  [[0.0893   0.0732   0.04715  ... 0.065    0.0351   0.233525]
   [0.091325 0.073425 0.047475 ... 0.0653   0.032675 0.238325]
   [0.096775 0.07645  0.051625 ... 0.06875  0.0344   0.252825]
   ...
   [0.0836   0.084875 0.061975 ... 0.07825  0.042875 0.38785 ]
   [0.08865  0.083825 0.060675 ... 0.0765   0.042525 0.3522  ]
   [0.0909   0.084475 0.061975 ... 0.0769   0.043275 0.342625]]

  [[0.092075 0.078    0.050925 ... 0.06565  0.03555  0.235275]
   [0.0805   0.0705   0.043325 ... 0.063925 0.03215  0.243875]
   [0.086925 0.074025 0.0495   ... 0.067475 0.03345  0.26095 ]
   ...
   [0.081075 0.078725 0.056425 ... 0.07505  0.0398   0.37805 ]
   [0.0865   0.079375 0.05845  ... 0.076175 0.0439   0.3619  ]
   [0.0886   0.077775 0.057725 ... 0.076175 0.042825 0.3439  ]]]


 [[[0.076525 0.0703   0.04595  ... 0.055225 0.028025 0.25075 ]
   [0.072025 0.0658   0.0446   ... 0.05555  0.02795  0.24755 ]
   [0.0669   0.06225  0.038125 ... 0.05245  0.027125 0.241425]
   ...
   [0.054175 0.050575 0.029475 ... 0.04845  0.022375 0.23045 ]
   [0.05465  0.052375 0.031125 ... 0.04935  0.024375 0.2282  ]
   [0.052525 0.052725 0.029275 ... 0.048325 0.02325  0.229475]]

  [[0.0784   0.065975 0.0441   ... 0.0594   0.031425 0.241175]
   [0.075475 0.066225 0.044975 ... 0.05505  0.02915  0.2405  ]
   [0.073375 0.063225 0.044475 ... 0.05435  0.029375 0.243575]
   ...
   [0.047325 0.05035  0.027125 ... 0.04535  0.022275 0.2235  ]
   [0.046475 0.051075 0.026425 ... 0.047025 0.021025 0.2348  ]
   [0.04295  0.050275 0.02575  ... 0.044525 0.01955  0.240875]]

  [[0.065825 0.0619   0.04045  ... 0.053225 0.026425 0.236775]
   [0.07745  0.062725 0.040725 ... 0.0573   0.030725 0.2439  ]
   [0.075525 0.063775 0.0434   ... 0.05595  0.030125 0.25005 ]
   ...
   [0.046675 0.048325 0.02605  ... 0.0475   0.0219   0.23165 ]
   [0.046825 0.04955  0.026425 ... 0.0471   0.02055  0.243125]
   [0.04435  0.0498   0.0253   ... 0.04675  0.020775 0.239925]]

  ...

  [[0.028025 0.041275 0.01945  ... 0.039375 0.015675 0.22205 ]
   [0.0245   0.040675 0.018025 ... 0.039575 0.016475 0.2187  ]
   [0.02185  0.03435  0.01665  ... 0.034025 0.015    0.20335 ]
   ...
   [0.1155   0.09395  0.0714   ... 0.058625 0.0275   0.335675]
   [0.117225 0.09435  0.0699   ... 0.05885  0.028175 0.34795 ]
   [0.1168   0.093275 0.06865  ... 0.0585   0.02895  0.353275]]

  [[0.032025 0.04075  0.020675 ... 0.04025  0.015525 0.2328  ]
   [0.024525 0.038175 0.018025 ... 0.03785  0.015075 0.21255 ]
   [0.0227   0.03625  0.016425 ... 0.035    0.015075 0.204675]
   ...
   [0.11625  0.093825 0.071275 ... 0.058625 0.02685  0.34765 ]
   [0.115325 0.092175 0.06915  ... 0.05855  0.02745  0.3572  ]
   [0.1143   0.091225 0.067325 ... 0.05835  0.028925 0.357825]]

  [[0.033325 0.04015  0.0212   ... 0.037875 0.015575 0.220525]
   [0.027225 0.038525 0.01925  ... 0.03625  0.014825 0.207775]
   [0.02625  0.03785  0.01885  ... 0.035675 0.015175 0.209825]
   ...
   [0.1132   0.09225  0.0699   ... 0.057875 0.027175 0.352875]
   [0.1116   0.090575 0.0685   ... 0.0585   0.027325 0.36045 ]
   [0.110325 0.089725 0.06665  ... 0.059425 0.02975  0.35485 ]]]


 [[[0.076325 0.0714   0.0511   ... 0.05685  0.027375 0.3285  ]
   [0.078825 0.066725 0.044825 ... 0.05665  0.03155  0.3196  ]
   [0.1038   0.0806   0.060575 ... 0.07545  0.048225 0.2805  ]
   ...
   [0.02885  0.040825 0.022125 ... 0.037725 0.016275 0.17815 ]
   [0.0286   0.0422   0.02355  ... 0.039625 0.016675 0.191225]
   [0.02775  0.04375  0.022175 ... 0.043325 0.0181   0.203775]]

  [[0.06785  0.062075 0.04025  ... 0.04975  0.026175 0.31845 ]
   [0.07785  0.06515  0.041575 ... 0.055275 0.033675 0.29555 ]
   [0.099375 0.0823   0.062    ... 0.076125 0.047775 0.27305 ]
   ...
   [0.026425 0.040625 0.021825 ... 0.037175 0.0163   0.180075]
   [0.0283   0.04245  0.02205  ... 0.04045  0.017175 0.192025]
   [0.02925  0.0436   0.022975 ... 0.043725 0.0179   0.20435 ]]

  [[0.064725 0.0621   0.0413   ... 0.05105  0.02655  0.30515 ]
   [0.08075  0.067625 0.0489   ... 0.0599   0.033625 0.28425 ]
   [0.1018   0.078725 0.060025 ... 0.0735   0.043225 0.2772  ]
   ...
   [0.0277   0.0412   0.020975 ... 0.03765  0.01625  0.184425]
   [0.02835  0.043125 0.021675 ... 0.040175 0.017375 0.19335 ]
   [0.030575 0.043325 0.023375 ... 0.04225  0.0173   0.200575]]

  ...

  [[0.06545  0.054525 0.034075 ... 0.05745  0.028325 0.244075]
   [0.06275  0.053075 0.03125  ... 0.055625 0.027675 0.247475]
   [0.060875 0.05235  0.030725 ... 0.053875 0.026575 0.247275]
   ...
   [0.04905  0.0508   0.031375 ... 0.039275 0.018625 0.184025]
   [0.047775 0.04855  0.03135  ... 0.038075 0.017725 0.173025]
   [0.048475 0.052025 0.0336   ... 0.0377   0.018625 0.172875]]

  [[0.061575 0.051675 0.03085  ... 0.052975 0.02525  0.244675]
   [0.056875 0.050975 0.027025 ... 0.051675 0.023125 0.243075]
   [0.051075 0.05215  0.027025 ... 0.052125 0.022625 0.2422  ]
   ...
   [0.051525 0.05075  0.031625 ... 0.039625 0.021775 0.1806  ]
   [0.0485   0.049475 0.031275 ... 0.03685  0.01885  0.181675]
   [0.054275 0.054875 0.036125 ... 0.037525 0.0198   0.171425]]

  [[0.055875 0.051075 0.02745  ... 0.04885  0.02285  0.2407  ]
   [0.056    0.052725 0.0285   ... 0.053175 0.02415  0.24375 ]
   [0.0544   0.05275  0.02815  ... 0.0555   0.0232   0.24885 ]
   ...
   [0.05005  0.051775 0.031    ... 0.03915  0.019525 0.1762  ]
   [0.048825 0.051275 0.0324   ... 0.036175 0.018375 0.18395 ]
   [0.0513   0.051225 0.031875 ... 0.0385   0.020625 0.177575]]]


 ...


 [[[0.059125 0.0521   0.0284   ... 0.046025 0.019975 0.234825]
   [0.06905  0.055875 0.0304   ... 0.04825  0.021725 0.237375]
   [0.0699   0.05865  0.031125 ... 0.051375 0.022725 0.23655 ]
   ...
   [0.034575 0.04225  0.0247   ... 0.03785  0.019175 0.157225]
   [0.029975 0.038475 0.023925 ... 0.034475 0.014425 0.175175]
   [0.025325 0.03555  0.02115  ... 0.0325   0.0144   0.157   ]]

  [[0.04895  0.051125 0.02935  ... 0.04475  0.0215   0.2242  ]
   [0.0563   0.05555  0.032025 ... 0.04655  0.0231   0.224225]
   [0.055875 0.0564   0.032875 ... 0.04815  0.023    0.232925]
   ...
   [0.0347   0.0392   0.0209   ... 0.035425 0.015675 0.17295 ]
   [0.031875 0.0362   0.02055  ... 0.029625 0.013925 0.14845 ]
   [0.028125 0.03385  0.020825 ... 0.026825 0.01315  0.13235 ]]

  [[0.0486   0.0514   0.028275 ... 0.046925 0.022425 0.22335 ]
   [0.05655  0.053425 0.028925 ... 0.047275 0.022825 0.219525]
   [0.0573   0.055525 0.0294   ... 0.0482   0.022275 0.2325  ]
   ...
   [0.024925 0.0378   0.019675 ... 0.032725 0.01405  0.18365 ]
   [0.031925 0.033875 0.0206   ... 0.03015  0.014075 0.169075]
   [0.0316   0.032025 0.019625 ... 0.0268   0.012925 0.136325]]

  ...

  [[0.067175 0.0628   0.039875 ... 0.052775 0.0307   0.2282  ]
   [0.080275 0.071475 0.050425 ... 0.0566   0.0342   0.217525]
   [0.07215  0.068375 0.045875 ... 0.056375 0.034375 0.2167  ]
   ...
   [0.03785  0.041425 0.023875 ... 0.043775 0.019575 0.213625]
   [0.03475  0.0394   0.02255  ... 0.04455  0.02     0.217375]
   [0.032625 0.039025 0.02305  ... 0.043425 0.01985  0.229575]]

  [[0.07875  0.068475 0.0437   ... 0.056175 0.0339   0.22795 ]
   [0.08205  0.073825 0.0498   ... 0.057775 0.035225 0.2253  ]
   [0.08115  0.07405  0.0505   ... 0.059475 0.03475  0.2217  ]
   ...
   [0.03895  0.043275 0.026075 ... 0.044775 0.021    0.2286  ]
   [0.03795  0.038525 0.02265  ... 0.04295  0.018625 0.22255 ]
   [0.03365  0.038425 0.02355  ... 0.042    0.0189   0.225125]]

  [[0.089    0.076325 0.0531   ... 0.05915  0.0333   0.228925]
   [0.084925 0.075775 0.050825 ... 0.05925  0.0363   0.236375]
   [0.08475  0.077325 0.050925 ... 0.0591   0.03615  0.225875]
   ...
   [0.040075 0.0416   0.025975 ... 0.044    0.020425 0.234125]
   [0.038075 0.036475 0.022375 ... 0.042175 0.01925  0.21895 ]
   [0.0349   0.036575 0.0241   ... 0.041525 0.0202   0.223625]]]


 [[[0.039875 0.055875 0.031825 ... 0.046725 0.0206   0.2473  ]
   [0.041225 0.053475 0.031675 ... 0.04425  0.01995  0.2442  ]
   [0.038    0.0509   0.030125 ... 0.04345  0.018975 0.252075]
   ...
   [0.079575 0.068025 0.048175 ... 0.0623   0.0347   0.275575]
   [0.093775 0.08395  0.063975 ... 0.12865  0.096575 0.214425]
   [0.102475 0.09315  0.07065  ... 0.124725 0.11835  0.17915 ]]

  [[0.039875 0.055025 0.034025 ... 0.0453   0.020225 0.25715 ]
   [0.039625 0.053725 0.032925 ... 0.0437   0.01945  0.250625]
   [0.03925  0.051775 0.031525 ... 0.0442   0.018825 0.2608  ]
   ...
   [0.080175 0.073025 0.052975 ... 0.06945  0.0391   0.219825]
   [0.09105  0.0811   0.05875  ... 0.09675  0.067    0.133375]
   [0.08775  0.0791   0.053775 ... 0.097075 0.066325 0.1061  ]]

  [[0.04015  0.05545  0.0358   ... 0.046    0.020325 0.2604  ]
   [0.0386   0.053425 0.035075 ... 0.04415  0.0186   0.259075]
   [0.038875 0.0541   0.035    ... 0.04585  0.0204   0.2731  ]
   ...
   [0.09545  0.086025 0.06205  ... 0.08275  0.050225 0.117975]
   [0.07805  0.07245  0.05015  ... 0.08905  0.06075  0.088825]
   [0.075975 0.07035  0.04505  ... 0.09075  0.064575 0.082325]]

  ...

  [[0.041475 0.041475 0.021175 ... 0.03885  0.015775 0.209025]
   [0.039625 0.040275 0.021525 ... 0.0381   0.01435  0.199925]
   [0.034975 0.040175 0.020375 ... 0.0356   0.014575 0.1891  ]
   ...
   [0.0552   0.048575 0.034275 ... 0.037725 0.020475 0.150825]
   [0.046975 0.04565  0.03075  ... 0.0352   0.01815  0.137475]
   [0.049075 0.04705  0.031375 ... 0.03935  0.02075  0.1534  ]]

  [[0.0475   0.04265  0.024375 ... 0.039125 0.0159   0.2042  ]
   [0.048075 0.042075 0.0262   ... 0.039575 0.015975 0.1975  ]
   [0.0455   0.041725 0.02305  ... 0.0391   0.0166   0.203425]
   ...
   [0.054875 0.04825  0.0329   ... 0.036975 0.020325 0.14335 ]
   [0.04635  0.0461   0.0307   ... 0.0349   0.018575 0.1444  ]
   [0.0477   0.045825 0.030225 ... 0.038175 0.0193   0.14945 ]]

  [[0.047625 0.042275 0.025025 ... 0.039375 0.016775 0.2007  ]
   [0.04795  0.043    0.02435  ... 0.039425 0.01655  0.198825]
   [0.057725 0.04625  0.03155  ... 0.0416   0.0185   0.20395 ]
   ...
   [0.0496   0.04615  0.03035  ... 0.036125 0.01925  0.138325]
   [0.0501   0.047175 0.030225 ... 0.0391   0.0216   0.158675]
   [0.04975  0.048025 0.030475 ... 0.038725 0.021075 0.1527  ]]]


 [[[0.09655  0.074775 0.050975 ... 0.0516   0.023025 0.261275]
   [0.092725 0.072675 0.0496   ... 0.058225 0.0292   0.208175]
   [0.080925 0.064725 0.04845  ... 0.08235  0.050425 0.170475]
   ...
   [0.047575 0.051725 0.026375 ... 0.044925 0.017175 0.256825]
   [0.055575 0.052925 0.030125 ... 0.048075 0.018    0.27485 ]
   [0.055525 0.0531   0.0318   ... 0.04635  0.01725  0.256675]]

  [[0.095525 0.07545  0.05235  ... 0.053225 0.022625 0.271925]
   [0.0957   0.075225 0.05265  ... 0.057725 0.02675  0.219325]
   [0.0937   0.071825 0.05245  ... 0.0824   0.05045  0.18085 ]
   ...
   [0.042775 0.048825 0.02565  ... 0.043875 0.016375 0.257325]
   [0.050625 0.051    0.028075 ... 0.04785  0.017925 0.282775]
   [0.0558   0.052    0.029675 ... 0.046875 0.017275 0.268275]]

  [[0.09525  0.076025 0.0528   ... 0.0533   0.021625 0.2891  ]
   [0.09735  0.0765   0.053    ... 0.055425 0.024675 0.244825]
   [0.09475  0.075125 0.05085  ... 0.071575 0.040575 0.1881  ]
   ...
   [0.038275 0.0477   0.0243   ... 0.043325 0.016    0.2494  ]
   [0.04245  0.050225 0.0255   ... 0.046025 0.01685  0.259525]
   [0.0483   0.052175 0.02775  ... 0.04545  0.017225 0.249375]]

  ...

  [[0.033875 0.045775 0.029025 ... 0.0404   0.018975 0.2029  ]
   [0.0357   0.04645  0.028025 ... 0.041925 0.0196   0.20415 ]
   [0.036975 0.046825 0.02825  ... 0.04005  0.018575 0.19235 ]
   ...
   [0.116775 0.0982   0.080175 ... 0.08415  0.06735  0.2857  ]
   [0.104525 0.09055  0.071025 ... 0.0795   0.0627   0.310825]
   [0.0975   0.082025 0.059075 ... 0.06885  0.045825 0.324375]]

  [[0.035775 0.042825 0.02835  ... 0.039125 0.0173   0.20685 ]
   [0.03505  0.0427   0.028275 ... 0.0397   0.017525 0.2041  ]
   [0.03665  0.0459   0.027125 ... 0.041575 0.0189   0.20055 ]
   ...
   [0.10555  0.088325 0.06645  ... 0.081425 0.059475 0.288725]
   [0.10945  0.091575 0.072325 ... 0.084475 0.057925 0.306175]
   [0.096675 0.0814   0.060425 ... 0.069775 0.04325  0.323975]]

  [[0.0381   0.0465   0.027175 ... 0.0385   0.0179   0.199175]
   [0.036325 0.04335  0.027625 ... 0.037975 0.016925 0.1999  ]
   [0.036475 0.047725 0.029125 ... 0.043325 0.019775 0.21835 ]
   ...
   [0.1108   0.1004   0.0796   ... 0.0981   0.084725 0.291575]
   [0.0959   0.0824   0.06165  ... 0.07685  0.0528   0.318575]
   [0.093025 0.07815  0.0585   ... 0.06915  0.0448   0.32745 ]]]], shape=(32, 256, 256, 8), dtype=float32)
outputs: float32 (32, 256, 256, 5)
tf.Tensor(
[[[[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]]

  ...

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [0. 1. 0. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]]


 [[[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]]

  ...

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]]]


 [[[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  ...

  [[0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]]]


 ...


 [[[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  ...

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]]


 [[[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [0. 0. 0. 1. 0.]
   [0. 0. 0. 1. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [0. 0. 0. 0. 1.]
   [0. 0. 0. 0. 1.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 0. 0. 0. 1.]
   [0. 0. 0. 0. 1.]
   [0. 0. 0. 0. 1.]]

  ...

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]]


 [[[0. 0. 1. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 0. 0. 0. 1.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 0. 0. 0. 1.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  ...

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 0. 0. 1. 0.]
   [0. 1. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 0. 0. 1. 0.]
   [0. 1. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 0. 0. 1. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]]], shape=(32, 256, 256, 5), dtype=float32)
Testing
inputs: float32 (1, 256, 256, 8)
tf.Tensor(
[[[[0.0853   0.0767   0.052625 ... 0.084725 0.048225 0.266675]
   [0.08645  0.076725 0.05415  ... 0.0815   0.049725 0.256475]
   [0.0881   0.07945  0.05675  ... 0.0833   0.049725 0.267   ]
   ...
   [0.041725 0.046875 0.027925 ... 0.04645  0.019175 0.2598  ]
   [0.03835  0.044725 0.024125 ... 0.04525  0.018175 0.2606  ]
   [0.0354   0.03985  0.021875 ... 0.044    0.017925 0.260925]]

  [[0.08945  0.072675 0.047475 ... 0.084925 0.045675 0.253325]
   [0.096    0.07225  0.048375 ... 0.088875 0.049475 0.25065 ]
   [0.10235  0.0735   0.0509   ... 0.088175 0.050675 0.269075]
   ...
   [0.042225 0.0459   0.026575 ... 0.04655  0.01875  0.265025]
   [0.040375 0.044525 0.02595  ... 0.04585  0.0186   0.26045 ]
   [0.03615  0.041075 0.022125 ... 0.044825 0.017775 0.263675]]

  [[0.087625 0.0762   0.0522   ... 0.084775 0.0459   0.243175]
   [0.09235  0.07215  0.048425 ... 0.0871   0.04725  0.243725]
   [0.104925 0.074375 0.05205  ... 0.0889   0.048275 0.25105 ]
   ...
   [0.04065  0.041975 0.023275 ... 0.043425 0.018075 0.25435 ]
   [0.0382   0.04225  0.02305  ... 0.0432   0.017725 0.254725]
   [0.037025 0.042925 0.022875 ... 0.046575 0.018425 0.259875]]

  ...

  [[0.074575 0.06     0.03945  ... 0.05635  0.03315  0.198025]
   [0.082    0.06205  0.040675 ... 0.058675 0.033075 0.198625]
   [0.080225 0.06355  0.0416   ... 0.059775 0.03395  0.206025]
   ...
   [0.09965  0.082725 0.06805  ... 0.067325 0.05815  0.27725 ]
   [0.0889   0.0679   0.0468   ... 0.0563   0.034875 0.29495 ]
   [0.07205  0.059575 0.04125  ... 0.05235  0.03185  0.3116  ]]

  [[0.0768   0.06205  0.039975 ... 0.058175 0.0334   0.197525]
   [0.0797   0.0638   0.041675 ... 0.060425 0.035925 0.1993  ]
   [0.08345  0.063725 0.04135  ... 0.0606   0.03585  0.2044  ]
   ...
   [0.110425 0.089975 0.071475 ... 0.083225 0.07175  0.261625]
   [0.0995   0.076725 0.053175 ... 0.060975 0.043725 0.29315 ]
   [0.07945  0.06385  0.0462   ... 0.059675 0.038375 0.32095 ]]

  [[0.074075 0.0615   0.0395   ... 0.0591   0.03185  0.200825]
   [0.0771   0.06265  0.040775 ... 0.059825 0.033975 0.204725]
   [0.0835   0.063125 0.0417   ... 0.059825 0.034325 0.2     ]
   ...
   [0.118575 0.0944   0.070325 ... 0.09795  0.078    0.272   ]
   [0.11975  0.0899   0.063575 ... 0.077975 0.05495  0.306325]
   [0.0861   0.068475 0.049775 ... 0.063225 0.039625 0.3163  ]]]], shape=(1, 256, 256, 8), dtype=float32)
outputs: float32 (1, 256, 256, 5)
tf.Tensor(
[[[[1. 0. 0. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 1. 0. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 0. 1. 0.]
   [0. 0. 0. 1. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 1. 0. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  ...

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [0. 0. 1. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [0. 0. 0. 1. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   ...
   [0. 0. 0. 1. 0.]
   [0. 0. 1. 0. 0.]
   [1. 0. 0. 0. 0.]]]], shape=(1, 256, 256, 5), dtype=float32)
Validation
inputs: float32 (1, 256, 256, 8)
tf.Tensor(
[[[[0.053275 0.043025 0.0284   ... 0.042575 0.01925  0.2313  ]
   [0.0535   0.04265  0.0293   ... 0.043975 0.0191   0.246425]
   [0.049125 0.042675 0.027125 ... 0.042275 0.019325 0.228225]
   ...
   [0.0724   0.064525 0.044325 ... 0.0504   0.0264   0.202325]
   [0.07395  0.0651   0.04495  ... 0.05235  0.02625  0.211175]
   [0.075975 0.0647   0.04615  ... 0.0523   0.027625 0.2079  ]]

  [[0.053025 0.042325 0.02895  ... 0.041625 0.018475 0.239625]
   [0.051225 0.0413   0.029    ... 0.042    0.018375 0.238775]
   [0.04785  0.04345  0.02785  ... 0.042625 0.019825 0.21835 ]
   ...
   [0.067    0.059125 0.042375 ... 0.049375 0.023475 0.18365 ]
   [0.0679   0.06215  0.042125 ... 0.050825 0.0246   0.197125]
   [0.066575 0.062775 0.041925 ... 0.049875 0.0247   0.199775]]

  [[0.04975  0.03945  0.0265   ... 0.040925 0.01785  0.243675]
   [0.050625 0.040725 0.027925 ... 0.040825 0.018625 0.236075]
   [0.0546   0.04545  0.029725 ... 0.043575 0.021075 0.20885 ]
   ...
   [0.069075 0.0611   0.0435   ... 0.050075 0.02435  0.186325]
   [0.07345  0.063225 0.0452   ... 0.052325 0.02595  0.19745 ]
   [0.068175 0.06035  0.04155  ... 0.04985  0.023925 0.1912  ]]

  ...

  [[0.064425 0.062275 0.037175 ... 0.0576   0.027975 0.265325]
   [0.058075 0.059925 0.03495  ... 0.05475  0.02585  0.26375 ]
   [0.040675 0.053675 0.028975 ... 0.0482   0.02065  0.250575]
   ...
   [0.0937   0.09025  0.072    ... 0.0486   0.02375  0.2789  ]
   [0.094125 0.091525 0.072925 ... 0.04795  0.02335  0.273275]
   [0.09135  0.08855  0.067875 ... 0.04985  0.023425 0.282475]]

  [[0.063175 0.05715  0.03525  ... 0.054475 0.0265   0.2553  ]
   [0.0581   0.0556   0.032875 ... 0.0511   0.0242   0.246625]
   [0.0396   0.0509   0.027975 ... 0.0464   0.020075 0.23445 ]
   ...
   [0.09535  0.0905   0.076275 ... 0.048725 0.0235   0.289175]
   [0.093725 0.09015  0.0717   ... 0.048325 0.02345  0.279575]
   [0.09145  0.088125 0.068475 ... 0.0493   0.023075 0.290275]]

  [[0.04605  0.05285  0.0288   ... 0.048925 0.021625 0.2413  ]
   [0.03955  0.051625 0.028325 ... 0.046975 0.020875 0.2319  ]
   [0.0431   0.052225 0.03135  ... 0.042275 0.02     0.221325]
   ...
   [0.099075 0.085075 0.06545  ... 0.051925 0.02575  0.298475]
   [0.100175 0.08775  0.0678   ... 0.05005  0.024175 0.28905 ]
   [0.09685  0.0912   0.07425  ... 0.049975 0.023375 0.290425]]]], shape=(1, 256, 256, 8), dtype=float32)
outputs: float32 (1, 256, 256, 5)
tf.Tensor(
[[[[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]
   [1. 0. 0. 0. 0.]]

  ...

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]]

  [[0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   [0. 0. 1. 0. 0.]
   ...
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]
   [0. 1. 0. 0. 0.]]]], shape=(1, 256, 256, 5), dtype=float32)
****************************************************************************
************************ building and compiling model... *******************
DERIVE_FEATURES: False
Model: "unet"
__________________________________________________________________________________________________
 Layer (type)                Output Shape                 Param #   Connected to                  
==================================================================================================
 input_1 (InputLayer)        [(None, None, None, 8)]      0         []                            
                                                                                                  
 conv2d (Conv2D)             (None, None, None, 32)       2336      ['input_1[0][0]']             
                                                                                                  
 batch_normalization (Batch  (None, None, None, 32)       128       ['conv2d[0][0]']              
 Normalization)                                                                                   
                                                                                                  
 activation (Activation)     (None, None, None, 32)       0         ['batch_normalization[0][0]'] 
                                                                                                  
 activation_1 (Activation)   (None, None, None, 32)       0         ['activation[0][0]']          
                                                                                                  
 separable_conv2d (Separabl  (None, None, None, 64)       2400      ['activation_1[0][0]']        
 eConv2D)                                                                                         
                                                                                                  
 batch_normalization_1 (Bat  (None, None, None, 64)       256       ['separable_conv2d[0][0]']    
 chNormalization)                                                                                 
                                                                                                  
 activation_2 (Activation)   (None, None, None, 64)       0         ['batch_normalization_1[0][0]'
                                                                    ]                             
                                                                                                  
 separable_conv2d_1 (Separa  (None, None, None, 64)       4736      ['activation_2[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_2 (Bat  (None, None, None, 64)       256       ['separable_conv2d_1[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 max_pooling2d (MaxPooling2  (None, None, None, 64)       0         ['batch_normalization_2[0][0]'
 D)                                                                 ]                             
                                                                                                  
 conv2d_1 (Conv2D)           (None, None, None, 64)       2112      ['activation[0][0]']          
                                                                                                  
 add (Add)                   (None, None, None, 64)       0         ['max_pooling2d[0][0]',       
                                                                     'conv2d_1[0][0]']            
                                                                                                  
 activation_3 (Activation)   (None, None, None, 64)       0         ['add[0][0]']                 
                                                                                                  
 separable_conv2d_2 (Separa  (None, None, None, 128)      8896      ['activation_3[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_3 (Bat  (None, None, None, 128)      512       ['separable_conv2d_2[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 activation_4 (Activation)   (None, None, None, 128)      0         ['batch_normalization_3[0][0]'
                                                                    ]                             
                                                                                                  
 separable_conv2d_3 (Separa  (None, None, None, 128)      17664     ['activation_4[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_4 (Bat  (None, None, None, 128)      512       ['separable_conv2d_3[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 max_pooling2d_1 (MaxPoolin  (None, None, None, 128)      0         ['batch_normalization_4[0][0]'
 g2D)                                                               ]                             
                                                                                                  
 conv2d_2 (Conv2D)           (None, None, None, 128)      8320      ['add[0][0]']                 
                                                                                                  
 add_1 (Add)                 (None, None, None, 128)      0         ['max_pooling2d_1[0][0]',     
                                                                     'conv2d_2[0][0]']            
                                                                                                  
 activation_5 (Activation)   (None, None, None, 128)      0         ['add_1[0][0]']               
                                                                                                  
 separable_conv2d_4 (Separa  (None, None, None, 256)      34176     ['activation_5[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_5 (Bat  (None, None, None, 256)      1024      ['separable_conv2d_4[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 activation_6 (Activation)   (None, None, None, 256)      0         ['batch_normalization_5[0][0]'
                                                                    ]                             
                                                                                                  
 separable_conv2d_5 (Separa  (None, None, None, 256)      68096     ['activation_6[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_6 (Bat  (None, None, None, 256)      1024      ['separable_conv2d_5[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 max_pooling2d_2 (MaxPoolin  (None, None, None, 256)      0         ['batch_normalization_6[0][0]'
 g2D)                                                               ]                             
                                                                                                  
 conv2d_3 (Conv2D)           (None, None, None, 256)      33024     ['add_1[0][0]']               
                                                                                                  
 add_2 (Add)                 (None, None, None, 256)      0         ['max_pooling2d_2[0][0]',     
                                                                     'conv2d_3[0][0]']            
                                                                                                  
 activation_7 (Activation)   (None, None, None, 256)      0         ['add_2[0][0]']               
                                                                                                  
 conv2d_transpose (Conv2DTr  (None, None, None, 256)      590080    ['activation_7[0][0]']        
 anspose)                                                                                         
                                                                                                  
 batch_normalization_7 (Bat  (None, None, None, 256)      1024      ['conv2d_transpose[0][0]']    
 chNormalization)                                                                                 
                                                                                                  
 activation_8 (Activation)   (None, None, None, 256)      0         ['batch_normalization_7[0][0]'
                                                                    ]                             
                                                                                                  
 conv2d_transpose_1 (Conv2D  (None, None, None, 256)      590080    ['activation_8[0][0]']        
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_8 (Bat  (None, None, None, 256)      1024      ['conv2d_transpose_1[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 up_sampling2d_1 (UpSamplin  (None, None, None, 256)      0         ['add_2[0][0]']               
 g2D)                                                                                             
                                                                                                  
 up_sampling2d (UpSampling2  (None, None, None, 256)      0         ['batch_normalization_8[0][0]'
 D)                                                                 ]                             
                                                                                                  
 conv2d_4 (Conv2D)           (None, None, None, 256)      65792     ['up_sampling2d_1[0][0]']     
                                                                                                  
 add_3 (Add)                 (None, None, None, 256)      0         ['up_sampling2d[0][0]',       
                                                                     'conv2d_4[0][0]']            
                                                                                                  
 activation_9 (Activation)   (None, None, None, 256)      0         ['add_3[0][0]']               
                                                                                                  
 conv2d_transpose_2 (Conv2D  (None, None, None, 128)      295040    ['activation_9[0][0]']        
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_9 (Bat  (None, None, None, 128)      512       ['conv2d_transpose_2[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 activation_10 (Activation)  (None, None, None, 128)      0         ['batch_normalization_9[0][0]'
                                                                    ]                             
                                                                                                  
 conv2d_transpose_3 (Conv2D  (None, None, None, 128)      147584    ['activation_10[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_10 (Ba  (None, None, None, 128)      512       ['conv2d_transpose_3[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 up_sampling2d_3 (UpSamplin  (None, None, None, 256)      0         ['add_3[0][0]']               
 g2D)                                                                                             
                                                                                                  
 up_sampling2d_2 (UpSamplin  (None, None, None, 128)      0         ['batch_normalization_10[0][0]
 g2D)                                                               ']                            
                                                                                                  
 conv2d_5 (Conv2D)           (None, None, None, 128)      32896     ['up_sampling2d_3[0][0]']     
                                                                                                  
 add_4 (Add)                 (None, None, None, 128)      0         ['up_sampling2d_2[0][0]',     
                                                                     'conv2d_5[0][0]']            
                                                                                                  
 activation_11 (Activation)  (None, None, None, 128)      0         ['add_4[0][0]']               
                                                                                                  
 conv2d_transpose_4 (Conv2D  (None, None, None, 64)       73792     ['activation_11[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_11 (Ba  (None, None, None, 64)       256       ['conv2d_transpose_4[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 activation_12 (Activation)  (None, None, None, 64)       0         ['batch_normalization_11[0][0]
                                                                    ']                            
                                                                                                  
 conv2d_transpose_5 (Conv2D  (None, None, None, 64)       36928     ['activation_12[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_12 (Ba  (None, None, None, 64)       256       ['conv2d_transpose_5[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 up_sampling2d_5 (UpSamplin  (None, None, None, 128)      0         ['add_4[0][0]']               
 g2D)                                                                                             
                                                                                                  
 up_sampling2d_4 (UpSamplin  (None, None, None, 64)       0         ['batch_normalization_12[0][0]
 g2D)                                                               ']                            
                                                                                                  
 conv2d_6 (Conv2D)           (None, None, None, 64)       8256      ['up_sampling2d_5[0][0]']     
                                                                                                  
 add_5 (Add)                 (None, None, None, 64)       0         ['up_sampling2d_4[0][0]',     
                                                                     'conv2d_6[0][0]']            
                                                                                                  
 activation_13 (Activation)  (None, None, None, 64)       0         ['add_5[0][0]']               
                                                                                                  
 conv2d_transpose_6 (Conv2D  (None, None, None, 32)       18464     ['activation_13[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_13 (Ba  (None, None, None, 32)       128       ['conv2d_transpose_6[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 activation_14 (Activation)  (None, None, None, 32)       0         ['batch_normalization_13[0][0]
                                                                    ']                            
                                                                                                  
 conv2d_transpose_7 (Conv2D  (None, None, None, 32)       9248      ['activation_14[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_14 (Ba  (None, None, None, 32)       128       ['conv2d_transpose_7[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 up_sampling2d_7 (UpSamplin  (None, None, None, 64)       0         ['add_5[0][0]']               
 g2D)                                                                                             
                                                                                                  
 up_sampling2d_6 (UpSamplin  (None, None, None, 32)       0         ['batch_normalization_14[0][0]
 g2D)                                                               ']                            
                                                                                                  
 conv2d_7 (Conv2D)           (None, None, None, 32)       2080      ['up_sampling2d_7[0][0]']     
                                                                                                  
 add_6 (Add)                 (None, None, None, 32)       0         ['up_sampling2d_6[0][0]',     
                                                                     'conv2d_7[0][0]']            
                                                                                                  
 final_conv (Conv2D)         (None, None, None, 5)        1445      ['add_6[0][0]']               
                                                                                                  
==================================================================================================
Total params: 2060997 (7.86 MB)
Trainable params: 2057221 (7.85 MB)
Non-trainable params: 3776 (14.75 KB)
__________________________________________________________________________________________________
None
****************************************************************************
************************ preparing output directory... *********************
&gt; Saving models and results at /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1...
****************************************************************************
****************************** training model... ***************************
Epoch 1/30
266/266 [==============================] - ETA: 0s - loss: 0.9676 - precision: 0.7271 - recall: 0.5957 - categorical_accuracy: 0.6706 - one_hot_io_u: 0.4242
Epoch 1: val_loss improved from inf to 2.63403, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 299s 971ms/step - loss: 0.9676 - precision: 0.7271 - recall: 0.5957 - categorical_accuracy: 0.6706 - one_hot_io_u: 0.4242 - val_loss: 2.6340 - val_precision: 0.3634 - val_recall: 0.3629 - val_categorical_accuracy: 0.3636 - val_one_hot_io_u: 0.0727
Epoch 2/30
266/266 [==============================] - ETA: 0s - loss: 0.6959 - precision: 0.8066 - recall: 0.6767 - categorical_accuracy: 0.7436 - one_hot_io_u: 0.5043
Epoch 2: val_loss improved from 2.63403 to 1.23879, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 263s 958ms/step - loss: 0.6959 - precision: 0.8066 - recall: 0.6767 - categorical_accuracy: 0.7436 - one_hot_io_u: 0.5043 - val_loss: 1.2388 - val_precision: 0.5670 - val_recall: 0.4644 - val_categorical_accuracy: 0.5205 - val_one_hot_io_u: 0.2377
Epoch 3/30
266/266 [==============================] - ETA: 0s - loss: 0.6352 - precision: 0.8285 - recall: 0.7046 - categorical_accuracy: 0.7664 - one_hot_io_u: 0.5343
Epoch 3: val_loss improved from 1.23879 to 0.62282, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 256s 966ms/step - loss: 0.6352 - precision: 0.8285 - recall: 0.7046 - categorical_accuracy: 0.7664 - one_hot_io_u: 0.5343 - val_loss: 0.6228 - val_precision: 0.8355 - val_recall: 0.7063 - val_categorical_accuracy: 0.7714 - val_one_hot_io_u: 0.5354
Epoch 4/30
266/266 [==============================] - ETA: 0s - loss: 0.5988 - precision: 0.8402 - recall: 0.7216 - categorical_accuracy: 0.7797 - one_hot_io_u: 0.5531
Epoch 4: val_loss improved from 0.62282 to 0.60250, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 252s 949ms/step - loss: 0.5988 - precision: 0.8402 - recall: 0.7216 - categorical_accuracy: 0.7797 - one_hot_io_u: 0.5531 - val_loss: 0.6025 - val_precision: 0.8380 - val_recall: 0.7265 - val_categorical_accuracy: 0.7809 - val_one_hot_io_u: 0.5544
Epoch 5/30
266/266 [==============================] - ETA: 0s - loss: 0.5687 - precision: 0.8498 - recall: 0.7352 - categorical_accuracy: 0.7904 - one_hot_io_u: 0.5689
Epoch 5: val_loss improved from 0.60250 to 0.55160, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 285s 1s/step - loss: 0.5687 - precision: 0.8498 - recall: 0.7352 - categorical_accuracy: 0.7904 - one_hot_io_u: 0.5689 - val_loss: 0.5516 - val_precision: 0.8510 - val_recall: 0.7493 - val_categorical_accuracy: 0.7973 - val_one_hot_io_u: 0.5788
Epoch 6/30
266/266 [==============================] - ETA: 0s - loss: 0.5453 - precision: 0.8571 - recall: 0.7454 - categorical_accuracy: 0.7985 - one_hot_io_u: 0.5813
Epoch 6: val_loss improved from 0.55160 to 0.52872, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 284s 1s/step - loss: 0.5453 - precision: 0.8571 - recall: 0.7454 - categorical_accuracy: 0.7985 - one_hot_io_u: 0.5813 - val_loss: 0.5287 - val_precision: 0.8590 - val_recall: 0.7552 - val_categorical_accuracy: 0.8039 - val_one_hot_io_u: 0.5882
Epoch 7/30
266/266 [==============================] - ETA: 0s - loss: 0.5278 - precision: 0.8624 - recall: 0.7530 - categorical_accuracy: 0.8045 - one_hot_io_u: 0.5905
Epoch 7: val_loss improved from 0.52872 to 0.50506, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 262s 988ms/step - loss: 0.5278 - precision: 0.8624 - recall: 0.7530 - categorical_accuracy: 0.8045 - one_hot_io_u: 0.5905 - val_loss: 0.5051 - val_precision: 0.8651 - val_recall: 0.7671 - val_categorical_accuracy: 0.8122 - val_one_hot_io_u: 0.5986
Epoch 8/30
266/266 [==============================] - ETA: 0s - loss: 0.5123 - precision: 0.8671 - recall: 0.7595 - categorical_accuracy: 0.8098 - one_hot_io_u: 0.5988
Epoch 8: val_loss improved from 0.50506 to 0.49242, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 264s 995ms/step - loss: 0.5123 - precision: 0.8671 - recall: 0.7595 - categorical_accuracy: 0.8098 - one_hot_io_u: 0.5988 - val_loss: 0.4924 - val_precision: 0.8745 - val_recall: 0.7668 - val_categorical_accuracy: 0.8169 - val_one_hot_io_u: 0.6102
Epoch 9/30
266/266 [==============================] - ETA: 0s - loss: 0.5018 - precision: 0.8700 - recall: 0.7641 - categorical_accuracy: 0.8133 - one_hot_io_u: 0.6049
Epoch 9: val_loss did not improve from 0.49242
266/266 [==============================] - 276s 1s/step - loss: 0.5018 - precision: 0.8700 - recall: 0.7641 - categorical_accuracy: 0.8133 - one_hot_io_u: 0.6049 - val_loss: 0.5025 - val_precision: 0.8643 - val_recall: 0.7700 - val_categorical_accuracy: 0.8133 - val_one_hot_io_u: 0.6085
Epoch 10/30
266/266 [==============================] - ETA: 0s - loss: 0.4895 - precision: 0.8736 - recall: 0.7693 - categorical_accuracy: 0.8175 - one_hot_io_u: 0.6118
Epoch 10: val_loss improved from 0.49242 to 0.47591, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 268s 1s/step - loss: 0.4895 - precision: 0.8736 - recall: 0.7693 - categorical_accuracy: 0.8175 - one_hot_io_u: 0.6118 - val_loss: 0.4759 - val_precision: 0.8705 - val_recall: 0.7823 - val_categorical_accuracy: 0.8220 - val_one_hot_io_u: 0.6160
Epoch 11/30
266/266 [==============================] - ETA: 0s - loss: 0.4791 - precision: 0.8766 - recall: 0.7737 - categorical_accuracy: 0.8210 - one_hot_io_u: 0.6176
Epoch 11: val_loss improved from 0.47591 to 0.46856, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 263s 992ms/step - loss: 0.4791 - precision: 0.8766 - recall: 0.7737 - categorical_accuracy: 0.8210 - one_hot_io_u: 0.6176 - val_loss: 0.4686 - val_precision: 0.8763 - val_recall: 0.7808 - val_categorical_accuracy: 0.8242 - val_one_hot_io_u: 0.6214
Epoch 12/30
266/266 [==============================] - ETA: 0s - loss: 0.4726 - precision: 0.8783 - recall: 0.7765 - categorical_accuracy: 0.8231 - one_hot_io_u: 0.6215
Epoch 12: val_loss did not improve from 0.46856
266/266 [==============================] - 255s 960ms/step - loss: 0.4726 - precision: 0.8783 - recall: 0.7765 - categorical_accuracy: 0.8231 - one_hot_io_u: 0.6215 - val_loss: 0.4780 - val_precision: 0.8752 - val_recall: 0.7766 - val_categorical_accuracy: 0.8217 - val_one_hot_io_u: 0.6226
Epoch 13/30
266/266 [==============================] - ETA: 0s - loss: 0.4617 - precision: 0.8814 - recall: 0.7812 - categorical_accuracy: 0.8269 - one_hot_io_u: 0.6277
Epoch 13: val_loss improved from 0.46856 to 0.45125, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 266s 1s/step - loss: 0.4617 - precision: 0.8814 - recall: 0.7812 - categorical_accuracy: 0.8269 - one_hot_io_u: 0.6277 - val_loss: 0.4513 - val_precision: 0.8810 - val_recall: 0.7881 - val_categorical_accuracy: 0.8299 - val_one_hot_io_u: 0.6327
Epoch 14/30
266/266 [==============================] - ETA: 0s - loss: 0.4553 - precision: 0.8830 - recall: 0.7839 - categorical_accuracy: 0.8290 - one_hot_io_u: 0.6312
Epoch 14: val_loss improved from 0.45125 to 0.44229, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 263s 992ms/step - loss: 0.4553 - precision: 0.8830 - recall: 0.7839 - categorical_accuracy: 0.8290 - one_hot_io_u: 0.6312 - val_loss: 0.4423 - val_precision: 0.8813 - val_recall: 0.7953 - val_categorical_accuracy: 0.8335 - val_one_hot_io_u: 0.6370
Epoch 15/30
266/266 [==============================] - ETA: 0s - loss: 0.4488 - precision: 0.8847 - recall: 0.7867 - categorical_accuracy: 0.8312 - one_hot_io_u: 0.6348
Epoch 15: val_loss did not improve from 0.44229
266/266 [==============================] - 258s 973ms/step - loss: 0.4488 - precision: 0.8847 - recall: 0.7867 - categorical_accuracy: 0.8312 - one_hot_io_u: 0.6348 - val_loss: 0.4579 - val_precision: 0.8785 - val_recall: 0.7875 - val_categorical_accuracy: 0.8283 - val_one_hot_io_u: 0.6359
Epoch 16/30
266/266 [==============================] - ETA: 0s - loss: 0.4440 - precision: 0.8859 - recall: 0.7889 - categorical_accuracy: 0.8328 - one_hot_io_u: 0.6378
Epoch 16: val_loss did not improve from 0.44229
266/266 [==============================] - 265s 998ms/step - loss: 0.4440 - precision: 0.8859 - recall: 0.7889 - categorical_accuracy: 0.8328 - one_hot_io_u: 0.6378 - val_loss: 0.4840 - val_precision: 0.8707 - val_recall: 0.7798 - val_categorical_accuracy: 0.8210 - val_one_hot_io_u: 0.6273
Epoch 17/30
266/266 [==============================] - ETA: 0s - loss: 0.4378 - precision: 0.8875 - recall: 0.7916 - categorical_accuracy: 0.8349 - one_hot_io_u: 0.6414
Epoch 17: val_loss did not improve from 0.44229
266/266 [==============================] - 285s 1s/step - loss: 0.4378 - precision: 0.8875 - recall: 0.7916 - categorical_accuracy: 0.8349 - one_hot_io_u: 0.6414 - val_loss: 0.4461 - val_precision: 0.8819 - val_recall: 0.7904 - val_categorical_accuracy: 0.8314 - val_one_hot_io_u: 0.6374
Epoch 18/30
266/266 [==============================] - ETA: 0s - loss: 0.4336 - precision: 0.8884 - recall: 0.7935 - categorical_accuracy: 0.8363 - one_hot_io_u: 0.6438
Epoch 18: val_loss improved from 0.44229 to 0.42199, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 278s 1s/step - loss: 0.4336 - precision: 0.8884 - recall: 0.7935 - categorical_accuracy: 0.8363 - one_hot_io_u: 0.6438 - val_loss: 0.4220 - val_precision: 0.8887 - val_recall: 0.8013 - val_categorical_accuracy: 0.8401 - val_one_hot_io_u: 0.6492
Epoch 19/30
266/266 [==============================] - ETA: 0s - loss: 0.4294 - precision: 0.8894 - recall: 0.7953 - categorical_accuracy: 0.8376 - one_hot_io_u: 0.6465
Epoch 19: val_loss improved from 0.42199 to 0.41151, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 282s 1s/step - loss: 0.4294 - precision: 0.8894 - recall: 0.7953 - categorical_accuracy: 0.8376 - one_hot_io_u: 0.6465 - val_loss: 0.4115 - val_precision: 0.8920 - val_recall: 0.8044 - val_categorical_accuracy: 0.8432 - val_one_hot_io_u: 0.6546
Epoch 20/30
266/266 [==============================] - ETA: 0s - loss: 0.4241 - precision: 0.8907 - recall: 0.7977 - categorical_accuracy: 0.8394 - one_hot_io_u: 0.6488
Epoch 20: val_loss did not improve from 0.41151
266/266 [==============================] - 258s 970ms/step - loss: 0.4241 - precision: 0.8907 - recall: 0.7977 - categorical_accuracy: 0.8394 - one_hot_io_u: 0.6488 - val_loss: 0.4151 - val_precision: 0.8930 - val_recall: 0.8001 - val_categorical_accuracy: 0.8419 - val_one_hot_io_u: 0.6524
Epoch 21/30
266/266 [==============================] - ETA: 0s - loss: 0.4196 - precision: 0.8919 - recall: 0.7998 - categorical_accuracy: 0.8410 - one_hot_io_u: 0.6520
Epoch 21: val_loss did not improve from 0.41151
266/266 [==============================] - 259s 977ms/step - loss: 0.4196 - precision: 0.8919 - recall: 0.7998 - categorical_accuracy: 0.8410 - one_hot_io_u: 0.6520 - val_loss: 0.4322 - val_precision: 0.8861 - val_recall: 0.7996 - val_categorical_accuracy: 0.8377 - val_one_hot_io_u: 0.6480
Epoch 22/30
266/266 [==============================] - ETA: 0s - loss: 0.4171 - precision: 0.8923 - recall: 0.8010 - categorical_accuracy: 0.8418 - one_hot_io_u: 0.6533
Epoch 22: val_loss did not improve from 0.41151
266/266 [==============================] - 260s 982ms/step - loss: 0.4171 - precision: 0.8923 - recall: 0.8010 - categorical_accuracy: 0.8418 - one_hot_io_u: 0.6533 - val_loss: 0.4217 - val_precision: 0.8869 - val_recall: 0.8027 - val_categorical_accuracy: 0.8398 - val_one_hot_io_u: 0.6500
Epoch 23/30
266/266 [==============================] - ETA: 0s - loss: 0.4134 - precision: 0.8931 - recall: 0.8027 - categorical_accuracy: 0.8430 - one_hot_io_u: 0.6551
Epoch 23: val_loss improved from 0.41151 to 0.40218, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 272s 1s/step - loss: 0.4134 - precision: 0.8931 - recall: 0.8027 - categorical_accuracy: 0.8430 - one_hot_io_u: 0.6551 - val_loss: 0.4022 - val_precision: 0.8928 - val_recall: 0.8101 - val_categorical_accuracy: 0.8464 - val_one_hot_io_u: 0.6619
Epoch 24/30
266/266 [==============================] - ETA: 0s - loss: 0.4117 - precision: 0.8936 - recall: 0.8035 - categorical_accuracy: 0.8436 - one_hot_io_u: 0.6563
Epoch 24: val_loss did not improve from 0.40218
266/266 [==============================] - 260s 981ms/step - loss: 0.4117 - precision: 0.8936 - recall: 0.8035 - categorical_accuracy: 0.8436 - one_hot_io_u: 0.6563 - val_loss: 0.4047 - val_precision: 0.8892 - val_recall: 0.8128 - val_categorical_accuracy: 0.8460 - val_one_hot_io_u: 0.6579
Epoch 25/30
266/266 [==============================] - ETA: 0s - loss: 0.4064 - precision: 0.8948 - recall: 0.8058 - categorical_accuracy: 0.8454 - one_hot_io_u: 0.6594
Epoch 25: val_loss improved from 0.40218 to 0.39190, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 298s 1s/step - loss: 0.4064 - precision: 0.8948 - recall: 0.8058 - categorical_accuracy: 0.8454 - one_hot_io_u: 0.6594 - val_loss: 0.3919 - val_precision: 0.8960 - val_recall: 0.8134 - val_categorical_accuracy: 0.8497 - val_one_hot_io_u: 0.6662
Epoch 26/30
266/266 [==============================] - ETA: 0s - loss: 0.4038 - precision: 0.8954 - recall: 0.8070 - categorical_accuracy: 0.8462 - one_hot_io_u: 0.6605
Epoch 26: val_loss improved from 0.39190 to 0.38542, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 280s 1s/step - loss: 0.4038 - precision: 0.8954 - recall: 0.8070 - categorical_accuracy: 0.8462 - one_hot_io_u: 0.6605 - val_loss: 0.3854 - val_precision: 0.8982 - val_recall: 0.8159 - val_categorical_accuracy: 0.8520 - val_one_hot_io_u: 0.6693
Epoch 27/30
266/266 [==============================] - ETA: 0s - loss: 0.4007 - precision: 0.8961 - recall: 0.8085 - categorical_accuracy: 0.8473 - one_hot_io_u: 0.6627
Epoch 27: val_loss improved from 0.38542 to 0.38379, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 283s 1s/step - loss: 0.4007 - precision: 0.8961 - recall: 0.8085 - categorical_accuracy: 0.8473 - one_hot_io_u: 0.6627 - val_loss: 0.3838 - val_precision: 0.8978 - val_recall: 0.8175 - val_categorical_accuracy: 0.8527 - val_one_hot_io_u: 0.6711
Epoch 28/30
266/266 [==============================] - ETA: 0s - loss: 0.3972 - precision: 0.8969 - recall: 0.8101 - categorical_accuracy: 0.8485 - one_hot_io_u: 0.6647
Epoch 28: val_loss improved from 0.38379 to 0.37968, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 264s 996ms/step - loss: 0.3972 - precision: 0.8969 - recall: 0.8101 - categorical_accuracy: 0.8485 - one_hot_io_u: 0.6647 - val_loss: 0.3797 - val_precision: 0.8977 - val_recall: 0.8211 - val_categorical_accuracy: 0.8543 - val_one_hot_io_u: 0.6748
Epoch 29/30
266/266 [==============================] - ETA: 0s - loss: 0.3962 - precision: 0.8970 - recall: 0.8105 - categorical_accuracy: 0.8488 - one_hot_io_u: 0.6653
Epoch 29: val_loss improved from 0.37968 to 0.37328, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 263s 989ms/step - loss: 0.3962 - precision: 0.8970 - recall: 0.8105 - categorical_accuracy: 0.8488 - one_hot_io_u: 0.6653 - val_loss: 0.3733 - val_precision: 0.8989 - val_recall: 0.8249 - val_categorical_accuracy: 0.8568 - val_one_hot_io_u: 0.6785
Epoch 30/30
266/266 [==============================] - ETA: 0s - loss: 0.3934 - precision: 0.8977 - recall: 0.8119 - categorical_accuracy: 0.8498 - one_hot_io_u: 0.6666
Epoch 30: val_loss improved from 0.37328 to 0.37270, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/modelCheckpoint
266/266 [==============================] - 265s 998ms/step - loss: 0.3934 - precision: 0.8977 - recall: 0.8119 - categorical_accuracy: 0.8498 - one_hot_io_u: 0.6666 - val_loss: 0.3727 - val_precision: 0.9007 - val_recall: 0.8224 - val_categorical_accuracy: 0.8565 - val_one_hot_io_u: 0.6781
****************************************************************************
****************************** evaluating model... *************************
************************************************
************************************************
Validation
1222/1222 [==============================] - 36s 22ms/step - loss: 0.3723 - precision: 0.9009 - recall: 0.8225 - categorical_accuracy: 0.8566 - one_hot_io_u: 0.6781
loss: 0.3722515106201172
precision: 0.9008649587631226
recall: 0.8225432634353638
categorical_accuracy: 0.8566350340843201
one_hot_io_u: 0.6780571341514587


****************************************************************************
****************************** saving parameters... ************************
****************************************************************************
*************** saving model config and history object... ******************
****************************************************************************
****************************** saving plots... *****************************
Saving plots and model visualization at /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1...
****************************************************************************
****************************** saving models... ****************************
****************************************************************************</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Rice_Mapping_Bhutan_2021_files/figure-html/cell-16-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="save-the-config-file" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="save-the-config-file"><span class="header-section-number">3.3.4</span> Save the config file</h3>
<div id="cell-38" class="cell" data-outputid="f751bd04-3c88-4cc6-fb98-ee80f115d8d6">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>config_file <span class="op">=</span> Path(config_file)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>drive_config_file <span class="op">=</span> Path(unet_config.MODEL_DIR <span class="op">/</span> <span class="ss">f"</span><span class="sc">{</span><span class="bu">str</span>(config_file)<span class="sc">.</span>split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the target directory if it doesn't exist</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>drive_config_file.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy the file</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>shutil.copy(config_file, drive_config_file)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"File copied from </span><span class="sc">{</span>config_file<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>drive_config_file<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>File copied from servir-aces/config.env to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/config.env</code></pre>
</div>
</div>
</section>
<section id="load-the-logs-files-via-tensorboard" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="load-the-logs-files-via-tensorboard"><span class="header-section-number">3.3.5</span> Load the logs files via TensorBoard</h3>
<p>Tensorboard provides a unique way to view and interact with the logs while the model is being trained. Learn more <a href="https://www.tensorflow.org/tensorboard/get_started">here</a>. Here we only show you how you can load them to tensorboard with our training logs.</p>
<div id="cell-41" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the TensorBoard notebook extension</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext tensorboard</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-42" class="cell" data-outputid="ff93a47c-3b66-4393-9579-2b86e3f8cc20" data-execution_count="29">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>log_dir_unet <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="bu">str</span>(unet_config.MODEL_DIR)<span class="sc">}</span><span class="ss">/logs"</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>log_dir_unet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>'/content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/unet_v1/logs'</code></pre>
</div>
</div>
<div id="cell-43" class="cell" data-outputid="30a9af61-22d2-4f18-9760-b535b73b5535" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>tensorboard <span class="op">--</span>logdir <span class="st">"</span><span class="sc">{log_dir_unet}</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Reusing TensorBoard on port 6007 (pid 5630), started 0:02:00 ago. (Use '!kill 5630' to kill it.)</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/javascript">

        (async () => {
            const url = new URL(await google.colab.kernel.proxyPort(6007, {'cache': true}));
            url.searchParams.set('tensorboardColab', 'true');
            const iframe = document.createElement('iframe');
            iframe.src = url;
            iframe.setAttribute('width', '100%');
            iframe.setAttribute('height', '800');
            iframe.setAttribute('frameborder', 0);
            document.body.appendChild(iframe);
        })();
    
</script>
</div>
</div>
</section>
<section id="load-the-saved-u-net-model" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="load-the-saved-u-net-model"><span class="header-section-number">3.3.6</span> Load the Saved U-Net Model</h3>
<p>Load the saved model</p>
<div id="cell-46" class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-47" class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>unet_model <span class="op">=</span> tf.keras.models.load_model(<span class="ss">f"</span><span class="sc">{</span><span class="bu">str</span>(unet_config.MODEL_DIR)<span class="sc">}</span><span class="ss">/trained-model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-48" class="cell" data-outputid="f5bdceec-a77d-4057-ba1c-d57661f46b21">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(unet_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "unet"
__________________________________________________________________________________________________
 Layer (type)                Output Shape                 Param #   Connected to                  
==================================================================================================
 input_1 (InputLayer)        [(None, None, None, 8)]      0         []                            
                                                                                                  
 conv2d (Conv2D)             (None, None, None, 32)       2336      ['input_1[0][0]']             
                                                                                                  
 batch_normalization (Batch  (None, None, None, 32)       128       ['conv2d[0][0]']              
 Normalization)                                                                                   
                                                                                                  
 activation (Activation)     (None, None, None, 32)       0         ['batch_normalization[0][0]'] 
                                                                                                  
 activation_1 (Activation)   (None, None, None, 32)       0         ['activation[0][0]']          
                                                                                                  
 separable_conv2d (Separabl  (None, None, None, 64)       2400      ['activation_1[0][0]']        
 eConv2D)                                                                                         
                                                                                                  
 batch_normalization_1 (Bat  (None, None, None, 64)       256       ['separable_conv2d[0][0]']    
 chNormalization)                                                                                 
                                                                                                  
 activation_2 (Activation)   (None, None, None, 64)       0         ['batch_normalization_1[0][0]'
                                                                    ]                             
                                                                                                  
 separable_conv2d_1 (Separa  (None, None, None, 64)       4736      ['activation_2[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_2 (Bat  (None, None, None, 64)       256       ['separable_conv2d_1[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 max_pooling2d (MaxPooling2  (None, None, None, 64)       0         ['batch_normalization_2[0][0]'
 D)                                                                 ]                             
                                                                                                  
 conv2d_1 (Conv2D)           (None, None, None, 64)       2112      ['activation[0][0]']          
                                                                                                  
 add (Add)                   (None, None, None, 64)       0         ['max_pooling2d[0][0]',       
                                                                     'conv2d_1[0][0]']            
                                                                                                  
 activation_3 (Activation)   (None, None, None, 64)       0         ['add[0][0]']                 
                                                                                                  
 separable_conv2d_2 (Separa  (None, None, None, 128)      8896      ['activation_3[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_3 (Bat  (None, None, None, 128)      512       ['separable_conv2d_2[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 activation_4 (Activation)   (None, None, None, 128)      0         ['batch_normalization_3[0][0]'
                                                                    ]                             
                                                                                                  
 separable_conv2d_3 (Separa  (None, None, None, 128)      17664     ['activation_4[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_4 (Bat  (None, None, None, 128)      512       ['separable_conv2d_3[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 max_pooling2d_1 (MaxPoolin  (None, None, None, 128)      0         ['batch_normalization_4[0][0]'
 g2D)                                                               ]                             
                                                                                                  
 conv2d_2 (Conv2D)           (None, None, None, 128)      8320      ['add[0][0]']                 
                                                                                                  
 add_1 (Add)                 (None, None, None, 128)      0         ['max_pooling2d_1[0][0]',     
                                                                     'conv2d_2[0][0]']            
                                                                                                  
 activation_5 (Activation)   (None, None, None, 128)      0         ['add_1[0][0]']               
                                                                                                  
 separable_conv2d_4 (Separa  (None, None, None, 256)      34176     ['activation_5[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_5 (Bat  (None, None, None, 256)      1024      ['separable_conv2d_4[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 activation_6 (Activation)   (None, None, None, 256)      0         ['batch_normalization_5[0][0]'
                                                                    ]                             
                                                                                                  
 separable_conv2d_5 (Separa  (None, None, None, 256)      68096     ['activation_6[0][0]']        
 bleConv2D)                                                                                       
                                                                                                  
 batch_normalization_6 (Bat  (None, None, None, 256)      1024      ['separable_conv2d_5[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 max_pooling2d_2 (MaxPoolin  (None, None, None, 256)      0         ['batch_normalization_6[0][0]'
 g2D)                                                               ]                             
                                                                                                  
 conv2d_3 (Conv2D)           (None, None, None, 256)      33024     ['add_1[0][0]']               
                                                                                                  
 add_2 (Add)                 (None, None, None, 256)      0         ['max_pooling2d_2[0][0]',     
                                                                     'conv2d_3[0][0]']            
                                                                                                  
 activation_7 (Activation)   (None, None, None, 256)      0         ['add_2[0][0]']               
                                                                                                  
 conv2d_transpose (Conv2DTr  (None, None, None, 256)      590080    ['activation_7[0][0]']        
 anspose)                                                                                         
                                                                                                  
 batch_normalization_7 (Bat  (None, None, None, 256)      1024      ['conv2d_transpose[0][0]']    
 chNormalization)                                                                                 
                                                                                                  
 activation_8 (Activation)   (None, None, None, 256)      0         ['batch_normalization_7[0][0]'
                                                                    ]                             
                                                                                                  
 conv2d_transpose_1 (Conv2D  (None, None, None, 256)      590080    ['activation_8[0][0]']        
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_8 (Bat  (None, None, None, 256)      1024      ['conv2d_transpose_1[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 up_sampling2d_1 (UpSamplin  (None, None, None, 256)      0         ['add_2[0][0]']               
 g2D)                                                                                             
                                                                                                  
 up_sampling2d (UpSampling2  (None, None, None, 256)      0         ['batch_normalization_8[0][0]'
 D)                                                                 ]                             
                                                                                                  
 conv2d_4 (Conv2D)           (None, None, None, 256)      65792     ['up_sampling2d_1[0][0]']     
                                                                                                  
 add_3 (Add)                 (None, None, None, 256)      0         ['up_sampling2d[0][0]',       
                                                                     'conv2d_4[0][0]']            
                                                                                                  
 activation_9 (Activation)   (None, None, None, 256)      0         ['add_3[0][0]']               
                                                                                                  
 conv2d_transpose_2 (Conv2D  (None, None, None, 128)      295040    ['activation_9[0][0]']        
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_9 (Bat  (None, None, None, 128)      512       ['conv2d_transpose_2[0][0]']  
 chNormalization)                                                                                 
                                                                                                  
 activation_10 (Activation)  (None, None, None, 128)      0         ['batch_normalization_9[0][0]'
                                                                    ]                             
                                                                                                  
 conv2d_transpose_3 (Conv2D  (None, None, None, 128)      147584    ['activation_10[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_10 (Ba  (None, None, None, 128)      512       ['conv2d_transpose_3[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 up_sampling2d_3 (UpSamplin  (None, None, None, 256)      0         ['add_3[0][0]']               
 g2D)                                                                                             
                                                                                                  
 up_sampling2d_2 (UpSamplin  (None, None, None, 128)      0         ['batch_normalization_10[0][0]
 g2D)                                                               ']                            
                                                                                                  
 conv2d_5 (Conv2D)           (None, None, None, 128)      32896     ['up_sampling2d_3[0][0]']     
                                                                                                  
 add_4 (Add)                 (None, None, None, 128)      0         ['up_sampling2d_2[0][0]',     
                                                                     'conv2d_5[0][0]']            
                                                                                                  
 activation_11 (Activation)  (None, None, None, 128)      0         ['add_4[0][0]']               
                                                                                                  
 conv2d_transpose_4 (Conv2D  (None, None, None, 64)       73792     ['activation_11[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_11 (Ba  (None, None, None, 64)       256       ['conv2d_transpose_4[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 activation_12 (Activation)  (None, None, None, 64)       0         ['batch_normalization_11[0][0]
                                                                    ']                            
                                                                                                  
 conv2d_transpose_5 (Conv2D  (None, None, None, 64)       36928     ['activation_12[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_12 (Ba  (None, None, None, 64)       256       ['conv2d_transpose_5[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 up_sampling2d_5 (UpSamplin  (None, None, None, 128)      0         ['add_4[0][0]']               
 g2D)                                                                                             
                                                                                                  
 up_sampling2d_4 (UpSamplin  (None, None, None, 64)       0         ['batch_normalization_12[0][0]
 g2D)                                                               ']                            
                                                                                                  
 conv2d_6 (Conv2D)           (None, None, None, 64)       8256      ['up_sampling2d_5[0][0]']     
                                                                                                  
 add_5 (Add)                 (None, None, None, 64)       0         ['up_sampling2d_4[0][0]',     
                                                                     'conv2d_6[0][0]']            
                                                                                                  
 activation_13 (Activation)  (None, None, None, 64)       0         ['add_5[0][0]']               
                                                                                                  
 conv2d_transpose_6 (Conv2D  (None, None, None, 32)       18464     ['activation_13[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_13 (Ba  (None, None, None, 32)       128       ['conv2d_transpose_6[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 activation_14 (Activation)  (None, None, None, 32)       0         ['batch_normalization_13[0][0]
                                                                    ']                            
                                                                                                  
 conv2d_transpose_7 (Conv2D  (None, None, None, 32)       9248      ['activation_14[0][0]']       
 Transpose)                                                                                       
                                                                                                  
 batch_normalization_14 (Ba  (None, None, None, 32)       128       ['conv2d_transpose_7[0][0]']  
 tchNormalization)                                                                                
                                                                                                  
 up_sampling2d_7 (UpSamplin  (None, None, None, 64)       0         ['add_5[0][0]']               
 g2D)                                                                                             
                                                                                                  
 up_sampling2d_6 (UpSamplin  (None, None, None, 32)       0         ['batch_normalization_14[0][0]
 g2D)                                                               ']                            
                                                                                                  
 conv2d_7 (Conv2D)           (None, None, None, 32)       2080      ['up_sampling2d_7[0][0]']     
                                                                                                  
 add_6 (Add)                 (None, None, None, 32)       0         ['up_sampling2d_6[0][0]',     
                                                                     'conv2d_7[0][0]']            
                                                                                                  
 final_conv (Conv2D)         (None, None, None, 5)        1445      ['add_6[0][0]']               
                                                                                                  
==================================================================================================
Total params: 2060997 (7.86 MB)
Trainable params: 2057221 (7.85 MB)
Non-trainable params: 3776 (14.75 KB)
__________________________________________________________________________________________________
None</code></pre>
</div>
</div>
</section>
<section id="inference-using-saved-u-net-model" class="level3" data-number="3.3.7">
<h3 data-number="3.3.7" class="anchored" data-anchor-id="inference-using-saved-u-net-model"><span class="header-section-number">3.3.7</span> Inference using Saved U-Net Model</h3>
<p>Now we can use the saved model to start the export of the prediction of the image. For prediction, you would need to first prepare your image data. We have already exported the image needed here, which we will use for now. See <a href="https://colab.research.google.com/drive/1MZexam3GZKsQySQO9Jk_RPNyyMLmciEq?usp=sharing">this notebook</a> to understand how we did it.</p>
<p>In addition, <a href="https://colab.research.google.com/drive/19AZ-I7YrGNSsWkqbzjNLw3MXVeV4N2uX?usp=sharing">this notebook</a> shows how you can then use the image to predict from the saved Model.</p>
<p>In any case, you now have the prediction in the Earth Engine as image.</p>
</section>
</section>
<section id="dnn-model" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="dnn-model"><span class="header-section-number">3.4</span> DNN Model</h2>
<section id="setup-any-changes-in-the-config-file-for-dnn-model" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="setup-any-changes-in-the-config-file-for-dnn-model"><span class="header-section-number">3.4.1</span> Setup any changes in the config file for DNN Model</h3>
<p>There are few config variables that needs to be changed for running a DNN model. First would be the data itself so let’s change the <code>DATADIR</code>. We also need to change our output directory using <code>MODEL_DIR_NAME</code>. This is the sub-directory inside the <code>OUTPUT_DIR</code> for this model run. We also need to specify this is the DNN model that we want to run. We have <code>MODEL_TYPE</code> parameter for that. Currently, it supports unet, dnn, and cnn (case sensitive) models; default being unet. Make other changes, as appropriate.</p>
<pre><code>DATADIR = "datasets/dnn_planet_wo_indices"
MODEL_DIR_NAME = "dnn_v1"
MODEL_TYPE = "dnn"</code></pre>
</section>
<section id="update-the-config-file-programtically-1" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="update-the-config-file-programtically-1"><span class="header-section-number">3.4.2</span> Update the config file programtically</h3>
<div id="cell-55" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>DATADIR <span class="op">=</span> <span class="st">"datasets/dnn_planet_wo_indices"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># PATCH_SHAPE, USE_ELEVATION, USE_S1, TRAIN_SIZE, TEST_SIZE, VAL_SIZE</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># BATCH_SIZE, EPOCHS are converted to their appropriate type.</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>MODEL_DIR_NAME <span class="op">=</span> <span class="st">"dnn_v1"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>MODEL_TYPE <span class="op">=</span> <span class="st">"dnn"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="st">"32"</span> <span class="co"># @param {type:"string"}</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="st">"30"</span> <span class="co"># @param {type:"string"}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-56" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>dnn_config_settings <span class="op">=</span> {</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DATADIR"</span>: DATADIR,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MODEL_DIR_NAME"</span>: MODEL_DIR_NAME,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MODEL_TYPE"</span>: MODEL_TYPE,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"BATCH_SIZE"</span>: BATCH_SIZE,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EPOCHS"</span>: EPOCHS,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-57" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> config_key <span class="kw">in</span> dnn_config_settings:</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    dotenv.set_key(dotenv_path<span class="op">=</span>config_file,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                   key_to_set<span class="op">=</span>config_key,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                   value_to_set<span class="op">=</span>dnn_config_settings[config_key]</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-config-file-variables-for-dnn-model" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="load-config-file-variables-for-dnn-model"><span class="header-section-number">3.4.3</span> Load config file variables for DNN Model</h3>
<div id="cell-59" class="cell" data-outputid="5018db03-3df7-4f78-e8a7-09cc66e3d211" data-execution_count="41">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>dnn_config <span class="op">=</span> Config(config_file<span class="op">=</span>config_file, override<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BASEDIR: /content
DATADIR: /content/datasets/dnn_planet_wo_indices
using features: ['red_before', 'green_before', 'blue_before', 'nir_before', 'red_during', 'green_during', 'blue_during', 'nir_during']
using labels: ['class']</code></pre>
</div>
</div>
<p>Most of the config in the <code>config.env</code> is now available via the config instance. Let’s check few of them here.</p>
<div id="cell-61" class="cell" data-outputid="c867ad8b-d755-470d-ce5a-b3246ec1448f" data-execution_count="42">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dnn_config.TRAINING_DIR, dnn_config.OUTPUT_DIR, dnn_config.BATCH_SIZE, dnn_config.MODEL_TYPE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>(PosixPath('/content/datasets/dnn_planet_wo_indices/training'),
 PosixPath('/content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output'),
 32,
 'dnn')</code></pre>
</div>
</div>
</section>
<section id="load-modeltrainer-class-1" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="load-modeltrainer-class-1"><span class="header-section-number">3.4.4</span> Load <code>ModelTrainer</code> class</h3>
<p>Next, let’s make an instance of the <code>ModelTrainer</code> object. The <code>ModelTrainer</code> class provides various tools for training, buidling, compiling, and running specified deep learning models.</p>
<div id="cell-64" class="cell" data-outputid="8c731ca8-ba05-4b20-ab20-614c6a94d01f" data-execution_count="43">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>dnn_model_trainer <span class="op">=</span> ModelTrainer(dnn_config, seed<span class="op">=</span><span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using seed: 42</code></pre>
</div>
</div>
</section>
<section id="train-and-save-dnn-model" class="level3" data-number="3.4.5">
<h3 data-number="3.4.5" class="anchored" data-anchor-id="train-and-save-dnn-model"><span class="header-section-number">3.4.5</span> Train and Save DNN model</h3>
<div id="cell-66" class="cell" data-outputid="e8263864-6791-42ad-fac2-ca9f8864be74">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dnn_model_trainer.train_model()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>****************************************************************************
****************************** Clear Session... ****************************
****************************************************************************
****************************** Configure memory growth... ************************
 &gt; Found 1 GPUs
****************************************************************************
****************************** creating datasets... ************************
Loading dataset from /content/datasets/dnn_planet_wo_indices/training/*
Loading dataset from /content/datasets/dnn_planet_wo_indices/validation/*
Loading dataset from /content/datasets/dnn_planet_wo_indices/testing/*
Printing dataset info:
Training
inputs: float32 (32, 1, 8)
tf.Tensor(
[[[0.06445  0.0383   0.09815  0.06755  0.269975 0.207325 0.11135
   0.060025]]

 [[0.075925 0.02705  0.08695  0.054775 0.235575 0.291625 0.1049
   0.0364  ]]

 [[0.043625 0.025    0.064175 0.04265  0.22     0.225    0.062025
   0.03195 ]]

 [[0.07915  0.05365  0.1054   0.093425 0.257325 0.28345  0.1119
   0.079675]]

 [[0.06945  0.025825 0.10755  0.062125 0.245125 0.28365  0.116975
   0.0485  ]]

 [[0.092425 0.07485  0.10285  0.09645  0.238575 0.252075 0.123025
   0.094825]]

 [[0.0555   0.02955  0.087325 0.09095  0.230625 0.298175 0.08075
   0.0524  ]]

 [[0.0643   0.021275 0.085875 0.0431   0.248075 0.27395  0.098625
   0.0284  ]]

 [[0.0747   0.047675 0.094625 0.072125 0.253125 0.267225 0.09725
   0.063825]]

 [[0.0626   0.023575 0.083675 0.04705  0.20645  0.2539   0.10465
   0.0317  ]]

 [[0.072725 0.030975 0.10185  0.0666   0.26585  0.38635  0.11875
   0.045725]]

 [[0.0713   0.0289   0.09355  0.06415  0.236675 0.2564   0.10215
   0.049475]]

 [[0.086175 0.077875 0.10745  0.0709   0.263475 0.289175 0.1188
   0.075975]]

 [[0.079575 0.027525 0.102325 0.054775 0.253875 0.2761   0.111325
   0.03985 ]]

 [[0.08825  0.0803   0.1016   0.0862   0.265025 0.260925 0.115625
   0.092325]]

 [[0.08025  0.10325  0.1034   0.13695  0.2283   0.246475 0.109975
   0.124   ]]

 [[0.077775 0.029875 0.0953   0.0546   0.235325 0.266    0.122125
   0.0469  ]]

 [[0.0778   0.024025 0.103525 0.053975 0.23395  0.263625 0.116025
   0.036825]]

 [[0.089475 0.070675 0.10515  0.09125  0.257725 0.254375 0.132675
   0.09745 ]]

 [[0.0785   0.026275 0.105575 0.051025 0.2552   0.2522   0.120125
   0.034825]]

 [[0.07945  0.045775 0.094475 0.0652   0.264175 0.335825 0.1147
   0.059275]]

 [[0.04725  0.031125 0.08165  0.065325 0.23025  0.2299   0.0981
   0.060525]]

 [[0.07475  0.02425  0.10205  0.04945  0.263225 0.178625 0.112775
   0.0373  ]]

 [[0.079875 0.0259   0.105875 0.05245  0.2505   0.269425 0.12245
   0.034975]]

 [[0.0746   0.033975 0.104075 0.0598   0.25375  0.29345  0.117325
   0.04885 ]]

 [[0.067125 0.026625 0.093575 0.05095  0.255925 0.231575 0.10545
   0.0415  ]]

 [[0.076325 0.02685  0.10615  0.05585  0.25805  0.276325 0.116725
   0.0417  ]]

 [[0.061275 0.023975 0.086025 0.041375 0.199425 0.255125 0.111
   0.030825]]

 [[0.059725 0.0203   0.0877   0.0434   0.230125 0.251975 0.105675
   0.027225]]

 [[0.07205  0.02285  0.094025 0.04865  0.2084   0.247225 0.119175
   0.03225 ]]

 [[0.0405   0.023025 0.06625  0.0505   0.218225 0.258275 0.0802
   0.03875 ]]

 [[0.07005  0.023125 0.111925 0.0475   0.2716   0.2495   0.124725
   0.0313  ]]], shape=(32, 1, 8), dtype=float32)
outputs: float32 (32, 1, 5)
tf.Tensor(
[[[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 0. 0. 1. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 0. 0. 1. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[1. 0. 0. 0. 0.]]

 [[0. 0. 1. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 0. 0. 1. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 0. 0. 1. 0.]]

 [[0. 0. 0. 1. 0.]]

 [[0. 0. 0. 1. 0.]]

 [[0. 0. 0. 1. 0.]]

 [[0. 0. 0. 1. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 0. 1. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 1. 0. 0. 0.]]

 [[0. 0. 0. 0. 1.]]

 [[0. 0. 1. 0. 0.]]

 [[0. 1. 0. 0. 0.]]], shape=(32, 1, 5), dtype=float32)
Testing
inputs: float32 (1, 1, 8)
tf.Tensor(
[[[0.06205  0.0342   0.081075 0.0639   0.24245  0.251675 0.086575
   0.054175]]], shape=(1, 1, 8), dtype=float32)
outputs: float32 (1, 1, 5)
tf.Tensor([[[1. 0. 0. 0. 0.]]], shape=(1, 1, 5), dtype=float32)
Validation
inputs: float32 (1, 1, 8)
tf.Tensor(
[[[0.067225 0.031725 0.092275 0.07245  0.23165  0.2267   0.103025
   0.05155 ]]], shape=(1, 1, 8), dtype=float32)
outputs: float32 (1, 1, 5)
tf.Tensor([[[0. 0. 0. 1. 0.]]], shape=(1, 1, 5), dtype=float32)
****************************************************************************
************************ building and compiling model... *******************
INITIAL_BIAS: None
Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 input_layer (InputLayer)    [(None, None, 8)]         0         
                                                                 
 dense (Dense)               (None, None, 256)         2304      
                                                                 
 dropout (Dropout)           (None, None, 256)         0         
                                                                 
 dense_1 (Dense)             (None, None, 128)         32896     
                                                                 
 dropout_1 (Dropout)         (None, None, 128)         0         
                                                                 
 dense_2 (Dense)             (None, None, 64)          8256      
                                                                 
 dropout_2 (Dropout)         (None, None, 64)          0         
                                                                 
 dense_3 (Dense)             (None, None, 32)          2080      
                                                                 
 dropout_3 (Dropout)         (None, None, 32)          0         
                                                                 
 dense_4 (Dense)             (None, None, 5)           165       
                                                                 
=================================================================
Total params: 45701 (178.52 KB)
Trainable params: 45701 (178.52 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None
****************************************************************************
************************ preparing output directory... *********************
&gt; Saving models and results at /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1...
****************************************************************************
****************************** training model... ***************************
Epoch 1/30
264/266 [============================&gt;.] - ETA: 0s - loss: 1.2595 - precision: 0.6700 - recall: 0.2397 - categorical_accuracy: 0.4964 - one_hot_io_u: 0.2151
Epoch 1: val_loss improved from inf to 1.15955, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 31s 99ms/step - loss: 1.2623 - precision: 0.6685 - recall: 0.2401 - categorical_accuracy: 0.4960 - one_hot_io_u: 0.2148 - val_loss: 1.1595 - val_precision: 0.6827 - val_recall: 0.4064 - val_categorical_accuracy: 0.5807 - val_one_hot_io_u: 0.2866
Epoch 2/30
265/266 [============================&gt;.] - ETA: 0s - loss: 0.9196 - precision: 0.7593 - recall: 0.5601 - categorical_accuracy: 0.6874 - one_hot_io_u: 0.4127
Epoch 2: val_loss improved from 1.15955 to 0.87784, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 16s 60ms/step - loss: 0.9206 - precision: 0.7592 - recall: 0.5596 - categorical_accuracy: 0.6871 - one_hot_io_u: 0.4125 - val_loss: 0.8778 - val_precision: 0.7574 - val_recall: 0.6090 - val_categorical_accuracy: 0.6968 - val_one_hot_io_u: 0.4428
Epoch 3/30
266/266 [==============================] - ETA: 0s - loss: 0.8111 - precision: 0.7857 - recall: 0.6387 - categorical_accuracy: 0.7218 - one_hot_io_u: 0.4734
Epoch 3: val_loss did not improve from 0.87784
266/266 [==============================] - 23s 89ms/step - loss: 0.8111 - precision: 0.7857 - recall: 0.6387 - categorical_accuracy: 0.7218 - one_hot_io_u: 0.4734 - val_loss: 0.8998 - val_precision: 0.8096 - val_recall: 0.4193 - val_categorical_accuracy: 0.7288 - val_one_hot_io_u: 0.4815
Epoch 4/30
261/266 [============================&gt;.] - ETA: 0s - loss: 0.7535 - precision: 0.8003 - recall: 0.6697 - categorical_accuracy: 0.7462 - one_hot_io_u: 0.5193
Epoch 4: val_loss improved from 0.87784 to 0.82494, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 16s 61ms/step - loss: 0.7584 - precision: 0.7999 - recall: 0.6640 - categorical_accuracy: 0.7440 - one_hot_io_u: 0.5169 - val_loss: 0.8249 - val_precision: 0.8067 - val_recall: 0.5383 - val_categorical_accuracy: 0.7317 - val_one_hot_io_u: 0.4902
Epoch 5/30
265/266 [============================&gt;.] - ETA: 0s - loss: 0.7328 - precision: 0.8096 - recall: 0.6695 - categorical_accuracy: 0.7466 - one_hot_io_u: 0.5352
Epoch 5: val_loss improved from 0.82494 to 0.74722, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 18s 66ms/step - loss: 0.7328 - precision: 0.8096 - recall: 0.6694 - categorical_accuracy: 0.7467 - one_hot_io_u: 0.5352 - val_loss: 0.7472 - val_precision: 0.8216 - val_recall: 0.6514 - val_categorical_accuracy: 0.7579 - val_one_hot_io_u: 0.5588
Epoch 6/30
264/266 [============================&gt;.] - ETA: 0s - loss: 0.7254 - precision: 0.8092 - recall: 0.6757 - categorical_accuracy: 0.7493 - one_hot_io_u: 0.5396
Epoch 6: val_loss improved from 0.74722 to 0.69727, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 16s 61ms/step - loss: 0.7268 - precision: 0.8086 - recall: 0.6749 - categorical_accuracy: 0.7487 - one_hot_io_u: 0.5391 - val_loss: 0.6973 - val_precision: 0.8324 - val_recall: 0.6755 - val_categorical_accuracy: 0.7696 - val_one_hot_io_u: 0.5790
Epoch 7/30
265/266 [============================&gt;.] - ETA: 0s - loss: 0.7175 - precision: 0.8121 - recall: 0.6877 - categorical_accuracy: 0.7531 - one_hot_io_u: 0.5439
Epoch 7: val_loss improved from 0.69727 to 0.69563, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 16s 61ms/step - loss: 0.7175 - precision: 0.8121 - recall: 0.6878 - categorical_accuracy: 0.7532 - one_hot_io_u: 0.5440 - val_loss: 0.6956 - val_precision: 0.8141 - val_recall: 0.6905 - val_categorical_accuracy: 0.7562 - val_one_hot_io_u: 0.5521
Epoch 8/30
265/266 [============================&gt;.] - ETA: 0s - loss: 0.7065 - precision: 0.8111 - recall: 0.6887 - categorical_accuracy: 0.7545 - one_hot_io_u: 0.5516
Epoch 8: val_loss improved from 0.69563 to 0.67199, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 24s 92ms/step - loss: 0.7066 - precision: 0.8109 - recall: 0.6885 - categorical_accuracy: 0.7542 - one_hot_io_u: 0.5513 - val_loss: 0.6720 - val_precision: 0.8114 - val_recall: 0.7196 - val_categorical_accuracy: 0.7716 - val_one_hot_io_u: 0.5806
Epoch 9/30
266/266 [==============================] - ETA: 0s - loss: 0.6927 - precision: 0.8161 - recall: 0.6925 - categorical_accuracy: 0.7579 - one_hot_io_u: 0.5574
Epoch 9: val_loss improved from 0.67199 to 0.66129, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 24s 92ms/step - loss: 0.6927 - precision: 0.8161 - recall: 0.6925 - categorical_accuracy: 0.7579 - one_hot_io_u: 0.5574 - val_loss: 0.6613 - val_precision: 0.8124 - val_recall: 0.7205 - val_categorical_accuracy: 0.7704 - val_one_hot_io_u: 0.5848
Epoch 10/30
264/266 [============================&gt;.] - ETA: 0s - loss: 0.6922 - precision: 0.8143 - recall: 0.6990 - categorical_accuracy: 0.7613 - one_hot_io_u: 0.5631
Epoch 10: val_loss did not improve from 0.66129
266/266 [==============================] - 23s 87ms/step - loss: 0.6936 - precision: 0.8139 - recall: 0.6985 - categorical_accuracy: 0.7607 - one_hot_io_u: 0.5626 - val_loss: 0.6650 - val_precision: 0.8180 - val_recall: 0.7234 - val_categorical_accuracy: 0.7720 - val_one_hot_io_u: 0.5882
Epoch 11/30
263/266 [============================&gt;.] - ETA: 0s - loss: 0.6978 - precision: 0.8120 - recall: 0.6963 - categorical_accuracy: 0.7553 - one_hot_io_u: 0.5598
Epoch 11: val_loss did not improve from 0.66129
266/266 [==============================] - 23s 87ms/step - loss: 0.6984 - precision: 0.8117 - recall: 0.6962 - categorical_accuracy: 0.7553 - one_hot_io_u: 0.5595 - val_loss: 0.6796 - val_precision: 0.8190 - val_recall: 0.7076 - val_categorical_accuracy: 0.7633 - val_one_hot_io_u: 0.5847
Epoch 12/30
263/266 [============================&gt;.] - ETA: 0s - loss: 0.6804 - precision: 0.8173 - recall: 0.7035 - categorical_accuracy: 0.7622 - one_hot_io_u: 0.5677
Epoch 12: val_loss improved from 0.66129 to 0.65464, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 17s 63ms/step - loss: 0.6806 - precision: 0.8177 - recall: 0.7042 - categorical_accuracy: 0.7626 - one_hot_io_u: 0.5679 - val_loss: 0.6546 - val_precision: 0.8114 - val_recall: 0.7230 - val_categorical_accuracy: 0.7745 - val_one_hot_io_u: 0.5955
Epoch 13/30
261/266 [============================&gt;.] - ETA: 0s - loss: 0.6858 - precision: 0.8154 - recall: 0.6991 - categorical_accuracy: 0.7605 - one_hot_io_u: 0.5657
Epoch 13: val_loss did not improve from 0.65464
266/266 [==============================] - 15s 56ms/step - loss: 0.6863 - precision: 0.8152 - recall: 0.6998 - categorical_accuracy: 0.7609 - one_hot_io_u: 0.5665 - val_loss: 0.6637 - val_precision: 0.8033 - val_recall: 0.7338 - val_categorical_accuracy: 0.7712 - val_one_hot_io_u: 0.5907
Epoch 14/30
264/266 [============================&gt;.] - ETA: 0s - loss: 0.6880 - precision: 0.8123 - recall: 0.6987 - categorical_accuracy: 0.7601 - one_hot_io_u: 0.5650
Epoch 14: val_loss did not improve from 0.65464
266/266 [==============================] - 24s 90ms/step - loss: 0.6894 - precision: 0.8119 - recall: 0.6984 - categorical_accuracy: 0.7595 - one_hot_io_u: 0.5648 - val_loss: 0.7179 - val_precision: 0.7723 - val_recall: 0.6801 - val_categorical_accuracy: 0.7309 - val_one_hot_io_u: 0.5505
Epoch 15/30
263/266 [============================&gt;.] - ETA: 0s - loss: 0.6748 - precision: 0.8167 - recall: 0.7041 - categorical_accuracy: 0.7643 - one_hot_io_u: 0.5692
Epoch 15: val_loss improved from 0.65464 to 0.64675, saving model to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/modelCheckpoint
266/266 [==============================] - 16s 60ms/step - loss: 0.6758 - precision: 0.8164 - recall: 0.7037 - categorical_accuracy: 0.7639 - one_hot_io_u: 0.5688 - val_loss: 0.6467 - val_precision: 0.8123 - val_recall: 0.7363 - val_categorical_accuracy: 0.7745 - val_one_hot_io_u: 0.5883
Epoch 16/30
265/266 [============================&gt;.] - ETA: 0s - loss: 0.6859 - precision: 0.8126 - recall: 0.7015 - categorical_accuracy: 0.7598 - one_hot_io_u: 0.5653
Epoch 16: val_loss did not improve from 0.64675
266/266 [==============================] - 24s 90ms/step - loss: 0.6850 - precision: 0.8129 - recall: 0.7020 - categorical_accuracy: 0.7602 - one_hot_io_u: 0.5664 - val_loss: 0.6541 - val_precision: 0.8152 - val_recall: 0.7284 - val_categorical_accuracy: 0.7720 - val_one_hot_io_u: 0.5856
Epoch 17/30
264/266 [============================&gt;.] - ETA: 0s - loss: 0.6713 - precision: 0.8203 - recall: 0.7104 - categorical_accuracy: 0.7682 - one_hot_io_u: 0.5777
Epoch 17: val_loss did not improve from 0.64675
266/266 [==============================] - 14s 54ms/step - loss: 0.6715 - precision: 0.8205 - recall: 0.7103 - categorical_accuracy: 0.7683 - one_hot_io_u: 0.5778 - val_loss: 0.6520 - val_precision: 0.8122 - val_recall: 0.7413 - val_categorical_accuracy: 0.7754 - val_one_hot_io_u: 0.5897
Epoch 18/30
261/266 [============================&gt;.] - ETA: 0s - loss: 0.6766 - precision: 0.8158 - recall: 0.6999 - categorical_accuracy: 0.7611 - one_hot_io_u: 0.5662
Epoch 18: val_loss did not improve from 0.64675
266/266 [==============================] - 24s 91ms/step - loss: 0.6716 - precision: 0.8175 - recall: 0.7020 - categorical_accuracy: 0.7632 - one_hot_io_u: 0.5692 - val_loss: 0.6723 - val_precision: 0.8073 - val_recall: 0.7354 - val_categorical_accuracy: 0.7745 - val_one_hot_io_u: 0.5787
Epoch 19/30
266/266 [==============================] - ETA: 0s - loss: 0.6681 - precision: 0.8207 - recall: 0.7084 - categorical_accuracy: 0.7657 - one_hot_io_u: 0.5756
Epoch 19: val_loss did not improve from 0.64675
266/266 [==============================] - 14s 54ms/step - loss: 0.6681 - precision: 0.8207 - recall: 0.7084 - categorical_accuracy: 0.7657 - one_hot_io_u: 0.5756 - val_loss: 0.7133 - val_precision: 0.7844 - val_recall: 0.7250 - val_categorical_accuracy: 0.7558 - val_one_hot_io_u: 0.5393
Epoch 20/30
263/266 [============================&gt;.] - ETA: 0s - loss: 0.6686 - precision: 0.8171 - recall: 0.7109 - categorical_accuracy: 0.7676 - one_hot_io_u: 0.5786
Epoch 20: val_loss did not improve from 0.64675
266/266 [==============================] - 15s 57ms/step - loss: 0.6676 - precision: 0.8176 - recall: 0.7113 - categorical_accuracy: 0.7680 - one_hot_io_u: 0.5788 - val_loss: 0.6900 - val_precision: 0.8031 - val_recall: 0.7429 - val_categorical_accuracy: 0.7725 - val_one_hot_io_u: 0.5750
Epoch 21/30
262/266 [============================&gt;.] - ETA: 0s - loss: 0.6652 - precision: 0.8173 - recall: 0.7029 - categorical_accuracy: 0.7663 - one_hot_io_u: 0.5746
Epoch 21: val_loss did not improve from 0.64675
266/266 [==============================] - 23s 89ms/step - loss: 0.6622 - precision: 0.8185 - recall: 0.7044 - categorical_accuracy: 0.7676 - one_hot_io_u: 0.5755 - val_loss: 0.6969 - val_precision: 0.8025 - val_recall: 0.7354 - val_categorical_accuracy: 0.7700 - val_one_hot_io_u: 0.5710
Epoch 22/30
265/266 [============================&gt;.] - ETA: 0s - loss: 0.6699 - precision: 0.8170 - recall: 0.7060 - categorical_accuracy: 0.7678 - one_hot_io_u: 0.5758
Epoch 22: val_loss did not improve from 0.64675
266/266 [==============================] - 17s 63ms/step - loss: 0.6699 - precision: 0.8172 - recall: 0.7063 - categorical_accuracy: 0.7679 - one_hot_io_u: 0.5761 - val_loss: 0.7111 - val_precision: 0.8088 - val_recall: 0.7354 - val_categorical_accuracy: 0.7708 - val_one_hot_io_u: 0.5744
Epoch 23/30
262/266 [============================&gt;.] - ETA: 0s - loss: 0.6639 - precision: 0.8248 - recall: 0.7085 - categorical_accuracy: 0.7693 - one_hot_io_u: 0.5784
Epoch 23: val_loss did not improve from 0.64675
266/266 [==============================] - 23s 87ms/step - loss: 0.6620 - precision: 0.8255 - recall: 0.7099 - categorical_accuracy: 0.7703 - one_hot_io_u: 0.5791 - val_loss: 0.7080 - val_precision: 0.7946 - val_recall: 0.7500 - val_categorical_accuracy: 0.7712 - val_one_hot_io_u: 0.5708
Epoch 24/30
262/266 [============================&gt;.] - ETA: 0s - loss: 0.6667 - precision: 0.8214 - recall: 0.7093 - categorical_accuracy: 0.7672 - one_hot_io_u: 0.5761
Epoch 24: val_loss did not improve from 0.64675
266/266 [==============================] - 24s 90ms/step - loss: 0.6651 - precision: 0.8218 - recall: 0.7104 - categorical_accuracy: 0.7681 - one_hot_io_u: 0.5768 - val_loss: 0.7125 - val_precision: 0.7986 - val_recall: 0.7371 - val_categorical_accuracy: 0.7687 - val_one_hot_io_u: 0.5655
Epoch 25/30
266/266 [==============================] - ETA: 0s - loss: 0.6620 - precision: 0.8192 - recall: 0.7146 - categorical_accuracy: 0.7716 - one_hot_io_u: 0.5834
Epoch 25: val_loss did not improve from 0.64675
266/266 [==============================] - 24s 90ms/step - loss: 0.6620 - precision: 0.8192 - recall: 0.7146 - categorical_accuracy: 0.7716 - one_hot_io_u: 0.5834 - val_loss: 0.7170 - val_precision: 0.7933 - val_recall: 0.7454 - val_categorical_accuracy: 0.7612 - val_one_hot_io_u: 0.5481
Epoch 26/30
264/266 [============================&gt;.] - ETA: 0s - loss: 0.6630 - precision: 0.8221 - recall: 0.7129 - categorical_accuracy: 0.7707 - one_hot_io_u: 0.5811
Epoch 26: val_loss did not improve from 0.64675
266/266 [==============================] - 14s 55ms/step - loss: 0.6636 - precision: 0.8220 - recall: 0.7131 - categorical_accuracy: 0.7708 - one_hot_io_u: 0.5811 - val_loss: 0.6966 - val_precision: 0.7934 - val_recall: 0.7446 - val_categorical_accuracy: 0.7675 - val_one_hot_io_u: 0.5624
Epoch 27/30
266/266 [==============================] - ETA: 0s - loss: 0.6562 - precision: 0.8221 - recall: 0.7137 - categorical_accuracy: 0.7681 - one_hot_io_u: 0.5774
Epoch 27: val_loss did not improve from 0.64675
266/266 [==============================] - 24s 91ms/step - loss: 0.6562 - precision: 0.8221 - recall: 0.7137 - categorical_accuracy: 0.7681 - one_hot_io_u: 0.5774 - val_loss: 0.6592 - val_precision: 0.8102 - val_recall: 0.7388 - val_categorical_accuracy: 0.7750 - val_one_hot_io_u: 0.5840
Epoch 28/30
264/266 [============================&gt;.] - ETA: 0s - loss: 0.6545 - precision: 0.8258 - recall: 0.7097 - categorical_accuracy: 0.7717 - one_hot_io_u: 0.5830
Epoch 28: val_loss did not improve from 0.64675
266/266 [==============================] - 14s 54ms/step - loss: 0.6543 - precision: 0.8259 - recall: 0.7099 - categorical_accuracy: 0.7720 - one_hot_io_u: 0.5832 - val_loss: 0.6637 - val_precision: 0.8178 - val_recall: 0.7359 - val_categorical_accuracy: 0.7766 - val_one_hot_io_u: 0.5848
Epoch 29/30
264/266 [============================&gt;.] - ETA: 0s - loss: 0.6576 - precision: 0.8259 - recall: 0.7109 - categorical_accuracy: 0.7687 - one_hot_io_u: 0.5800
Epoch 29: val_loss did not improve from 0.64675
266/266 [==============================] - 16s 61ms/step - loss: 0.6561 - precision: 0.8265 - recall: 0.7112 - categorical_accuracy: 0.7689 - one_hot_io_u: 0.5802 - val_loss: 0.6871 - val_precision: 0.7955 - val_recall: 0.7329 - val_categorical_accuracy: 0.7633 - val_one_hot_io_u: 0.5514
Epoch 30/30
266/266 [==============================] - ETA: 0s - loss: 0.6533 - precision: 0.8234 - recall: 0.7118 - categorical_accuracy: 0.7696 - one_hot_io_u: 0.5826
Epoch 30: val_loss did not improve from 0.64675
266/266 [==============================] - 15s 56ms/step - loss: 0.6533 - precision: 0.8234 - recall: 0.7118 - categorical_accuracy: 0.7696 - one_hot_io_u: 0.5826 - val_loss: 0.6730 - val_precision: 0.8023 - val_recall: 0.7359 - val_categorical_accuracy: 0.7683 - val_one_hot_io_u: 0.5576
****************************************************************************
****************************** evaluating model... *************************
************************************************
************************************************
Validation
1219/1219 [==============================] - 7s 6ms/step - loss: 0.6585 - precision: 0.8038 - recall: 0.7293 - categorical_accuracy: 0.7736 - one_hot_io_u: 0.5689
loss: 0.6584734320640564
precision: 0.8037974834442139
recall: 0.7292863130569458
categorical_accuracy: 0.7735849022865295
one_hot_io_u: 0.5688682794570923


****************************************************************************
****************************** saving parameters... ************************
****************************************************************************
*************** saving model config and history object... ******************
****************************************************************************
****************************** saving plots... *****************************
Saving plots and model visualization at /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1...
****************************************************************************
****************************** saving models... ****************************
****************************************************************************</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Rice_Mapping_Bhutan_2021_files/figure-html/cell-30-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="save-the-config-file-1" class="level3" data-number="3.4.6">
<h3 data-number="3.4.6" class="anchored" data-anchor-id="save-the-config-file-1"><span class="header-section-number">3.4.6</span> Save the config file</h3>
<div id="cell-68" class="cell" data-outputid="48f021ce-949b-44df-bbaf-d7e401886040">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>drive_config_file <span class="op">=</span> Path(dnn_config.MODEL_DIR <span class="op">/</span> <span class="ss">f"</span><span class="sc">{</span><span class="bu">str</span>(config_file)<span class="sc">.</span>split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the target directory if it doesn't exist</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>drive_config_file.parent.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy the file</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>shutil.copy(config_file, drive_config_file)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"File copied from </span><span class="sc">{</span>config_file<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>drive_config_file<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>File copied from servir-aces/config.env to /content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/config.env</code></pre>
</div>
</div>
</section>
<section id="load-the-logs-files-via-tensorboard-1" class="level3" data-number="3.4.7">
<h3 data-number="3.4.7" class="anchored" data-anchor-id="load-the-logs-files-via-tensorboard-1"><span class="header-section-number">3.4.7</span> Load the logs files via TensorBoard</h3>
<div id="cell-70" class="cell" data-outputid="99cdda0a-82e6-4f65-afd9-e0fd944ae4db" data-execution_count="44">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>log_dir_dnn <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span><span class="bu">str</span>(dnn_config.MODEL_DIR)<span class="sc">}</span><span class="ss">/logs"</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>log_dir_dnn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>'/content/drive/MyDrive/Colab Notebooks/DL_Book/Chapter_1/output/dnn_v1/logs'</code></pre>
</div>
</div>
<div id="cell-71" class="cell" data-outputid="3fadcdc1-4dd7-4b16-d623-015c431640e1" data-execution_count="45">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>tensorboard <span class="op">--</span>logdir <span class="st">"</span><span class="sc">{log_dir_dnn}</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/javascript">

        (async () => {
            const url = new URL(await google.colab.kernel.proxyPort(6008, {'cache': true}));
            url.searchParams.set('tensorboardColab', 'true');
            const iframe = document.createElement('iframe');
            iframe.src = url;
            iframe.setAttribute('width', '100%');
            iframe.setAttribute('height', '800');
            iframe.setAttribute('frameborder', 0);
            document.body.appendChild(iframe);
        })();
    
</script>
</div>
</div>
</section>
<section id="load-the-saved-dnn-model" class="level3" data-number="3.4.8">
<h3 data-number="3.4.8" class="anchored" data-anchor-id="load-the-saved-dnn-model"><span class="header-section-number">3.4.8</span> Load the Saved DNN Model</h3>
<div id="cell-73" class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>dnn_model <span class="op">=</span> tf.keras.models.load_model(<span class="ss">f"</span><span class="sc">{</span><span class="bu">str</span>(dnn_config.MODEL_DIR)<span class="sc">}</span><span class="ss">/trained-model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-74" class="cell" data-outputid="f6fa4ff9-813f-4a4b-a0f3-b73f83382952">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dnn_model.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model: "model"
_________________________________________________________________
 Layer (type)                Output Shape              Param #   
=================================================================
 input_layer (InputLayer)    [(None, None, 8)]         0         
                                                                 
 dense (Dense)               (None, None, 256)         2304      
                                                                 
 dropout (Dropout)           (None, None, 256)         0         
                                                                 
 dense_1 (Dense)             (None, None, 128)         32896     
                                                                 
 dropout_1 (Dropout)         (None, None, 128)         0         
                                                                 
 dense_2 (Dense)             (None, None, 64)          8256      
                                                                 
 dropout_2 (Dropout)         (None, None, 64)          0         
                                                                 
 dense_3 (Dense)             (None, None, 32)          2080      
                                                                 
 dropout_3 (Dropout)         (None, None, 32)          0         
                                                                 
 dense_4 (Dense)             (None, None, 5)           165       
                                                                 
=================================================================
Total params: 45701 (178.52 KB)
Trainable params: 45701 (178.52 KB)
Non-trainable params: 0 (0.00 Byte)
_________________________________________________________________
None</code></pre>
</div>
</div>
</section>
<section id="inference-using-saved-dnn-model" class="level3" data-number="3.4.9">
<h3 data-number="3.4.9" class="anchored" data-anchor-id="inference-using-saved-dnn-model"><span class="header-section-number">3.4.9</span> Inference using Saved DNN Model</h3>
<p>Now we can use the saved model to start the export of the prediction of the image. For prediction, you would need to first prepare your image data. We have already exported the image needed here, which we will use for now. See <a href="https://colab.research.google.com/drive/1MZexam3GZKsQySQO9Jk_RPNyyMLmciEq?usp=sharing">this notebook</a> to understand how we did it.</p>
<p>In addition, <a href="https://colab.research.google.com/drive/1c59eWgw637n1aQfyIobOKIIulqKSXeqv?usp=sharing">this notebook</a> shows how you can then use the image to predict from the saved Model.</p>
<p>In any case, you now have the prediction in the Earth Engine as image.</p>
</section>
</section>
<section id="independent-validation" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="independent-validation"><span class="header-section-number">3.5</span> Independent Validation</h2>
<p>For independent validation, we will use a file that we have prepared. These files were collected using <a href="https://app.collect.earth/home">Collect Earth Online</a> by SCO and NASA DEVELOP interns. We will be using GEE here. Before we do that, let’s make changes in our config file.</p>
<p>We will make sure our <code>GCS_PROJECT</code> is setup correctly.</p>
<pre><code>GCS_PROJECT = "servir-ee"</code></pre>
<section id="update-the-config-file" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="update-the-config-file"><span class="header-section-number">3.5.1</span> Update the config file</h3>
<div id="cell-81" class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>GCS_PROJECT <span class="op">=</span> <span class="st">"servir-ee"</span> <span class="co"># @param {type:"string"}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-82" class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>config_settings <span class="op">=</span> {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GCS_PROJECT"</span>: GCS_PROJECT,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-83" class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> config_key <span class="kw">in</span> config_settings:</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    dotenv.set_key(dotenv_path<span class="op">=</span>config_file,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                   key_to_set<span class="op">=</span>config_key,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                   value_to_set<span class="op">=</span>config_settings[config_key]</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-config-file-variable" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="load-config-file-variable"><span class="header-section-number">3.5.2</span> Load config file variable</h3>
<div id="cell-85" class="cell" data-outputid="51b1a579-56f4-4bf9-938d-9f0d016a022d">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>config <span class="op">=</span> Config(config_file<span class="op">=</span>config_file, override<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BASEDIR: /content
DATADIR: /content/datasets/dnn_planet_wo_indices
using features: ['red_before', 'green_before', 'blue_before', 'nir_before', 'red_during', 'green_during', 'blue_during', 'nir_during']
using labels: ['class']</code></pre>
</div>
</div>
</section>
<section id="import-earthengine-and-geemap-for-visualization" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="import-earthengine-and-geemap-for-visualization"><span class="header-section-number">3.5.3</span> Import earthengine and geemap for visualization</h3>
<div id="cell-87" class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import, authenticate and initialize the Earth Engine library.</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ee</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>ee.Authenticate()</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>EEUtils.initialize_session(use_highvolume<span class="op">=</span><span class="va">True</span>, project<span class="op">=</span>config.GCS_PROJECT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-88" class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geemap</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>Map <span class="op">=</span> geemap.Map()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="class-information-and-masking" class="level3" data-number="3.5.4">
<h3 data-number="3.5.4" class="anchored" data-anchor-id="class-information-and-masking"><span class="header-section-number">3.5.4</span> Class Information and Masking</h3>
<div id="cell-90" class="cell" data-outputid="c8d93ba3-f58d-4c69-bbdf-867d44fbe4ea">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CLASS</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 - cropland etc.</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 - rice</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 - forest</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 3 - Built up</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 4 - Others (includes water body)</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>l1 <span class="op">=</span> ee.FeatureCollection(<span class="st">"projects/servir-sco-assets/assets/Bhutan/BT_Admin_1"</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>paro <span class="op">=</span> l1.<span class="bu">filter</span>(ee.Filter.eq(<span class="st">"ADM1_EN"</span>, <span class="st">"Paro"</span>))</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># mask the rice growing zone</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># in Paro, rice grows upto 2600 m asl (double check to make sure??)</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>dem <span class="op">=</span> ee.Image(<span class="st">"MERIT/DEM/v1_0_3"</span>) <span class="co"># ee.Image('USGS/SRTMGL1_003')</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>dem <span class="op">=</span> dem.clip(paro)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>rice_zone <span class="op">=</span> dem.gte(<span class="dv">0</span>).And(dem.lte(<span class="dv">2600</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
</section>
<section id="model-u-net" class="level3" data-number="3.5.5">
<h3 data-number="3.5.5" class="anchored" data-anchor-id="model-u-net"><span class="header-section-number">3.5.5</span> Model: U-Net</h3>
<section id="load-and-visualize-the-prediction-output" class="level4" data-number="3.5.5.1">
<h4 data-number="3.5.5.1" class="anchored" data-anchor-id="load-and-visualize-the-prediction-output"><span class="header-section-number">3.5.5.1</span> Load and visualize the prediction output</h4>
<div id="cell-93" class="cell" data-outputid="0da7abaf-6e17-4c63-ccb0-016f1c019316">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>UNET_RGBN <span class="op">=</span> ee.Image(<span class="st">"projects/servir-ee/assets/dl-book/chapter-1/prediction/prediction_unet_v1"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>UNET_RGBN <span class="op">=</span> UNET_RGBN.updateMask(rice_zone)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>Map.centerObject(UNET_RGBN, <span class="dv">11</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>Map.addLayer(UNET_RGBN.clip(paro), {<span class="st">"bands"</span>: [<span class="st">"prediction"</span>], <span class="st">"min"</span>:<span class="dv">0</span>, <span class="st">"max"</span>:<span class="dv">4</span>, <span class="st">"palette"</span>: [<span class="st">"FFFF00"</span>, <span class="st">"FFC0CB"</span>, <span class="st">"267300"</span>, <span class="st">"E60000"</span>, <span class="st">"005CE6"</span>]}, <span class="st">"UNET_RGBN"</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>Map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e62f4972a04047768315ec5337734964","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</section>
<section id="calculate-classification-metrics" class="level4" data-number="3.5.5.2">
<h4 data-number="3.5.5.2" class="anchored" data-anchor-id="calculate-classification-metrics"><span class="header-section-number">3.5.5.2</span> Calculate classification metrics</h4>
<p>Remapping to rice and non-rice output</p>
<div id="cell-96" class="cell" data-outputid="f0f64493-74c6-4f1a-9583-732b5cf0647a">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>UNET_RGBN_remapped <span class="op">=</span> UNET_RGBN.remap([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], <span class="dv">0</span>, <span class="st">"prediction"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>Map.addLayer(UNET_RGBN_remapped, {<span class="st">"min"</span>: <span class="dv">0</span>, <span class="st">"max"</span>: <span class="dv">1</span>, <span class="st">"palette"</span>: [<span class="st">"cfcf00"</span>, <span class="st">"267300"</span>]}, <span class="st">"UNET_RGBN_remapped"</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>Map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e62f4972a04047768315ec5337734964","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-97" class="cell" data-outputid="0b58e242-61da-4d02-bae1-e06b81dd4740">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>sampling_geom <span class="op">=</span> ee.FeatureCollection(<span class="st">"projects/servir-ee/assets/dl-book/chapter-1/data/sampledGeom"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>ceo_final_data <span class="op">=</span> ee.FeatureCollection(<span class="st">"projects/servir-ee/assets/dl-book/chapter-1/data/ceoData"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>ceo_final_data <span class="op">=</span> ee.FeatureCollection(ceo_final_data.<span class="bu">filter</span>(ee.Filter.bounds(sampling_geom).Not()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-98" class="cell" data-outputid="f0b56aa8-fad3-437a-e402-f05788e253bf">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>prediction_unet <span class="op">=</span> UNET_RGBN_remapped.sampleRegions(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    collection <span class="op">=</span> ceo_final_data,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    scale <span class="op">=</span> <span class="dv">10</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    geometries <span class="op">=</span> <span class="va">True</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print("predictionOutputUnet", prediction_unet.getInfo())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-99" class="cell" data-outputid="823782a4-4832-4a0e-e987-2f125ef86715">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>error_matrix_unet <span class="op">=</span> prediction_unet.errorMatrix(actual<span class="op">=</span><span class="st">"rice"</span>, predicted<span class="op">=</span><span class="st">"remapped"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>test_acc_unet <span class="op">=</span> error_matrix_unet.accuracy()</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>test_kappa_unet <span class="op">=</span> error_matrix_unet.kappa()</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>test_recall_producer_acc_unet <span class="op">=</span> error_matrix_unet.producersAccuracy().get([<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>test_precision_consumer_acc_unet <span class="op">=</span> error_matrix_unet.consumersAccuracy().get([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>f1_unet <span class="op">=</span> error_matrix_unet.fscore().get([<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-100" class="cell" data-outputid="21ef35bb-6cab-476e-cd2d-36bde597fb09">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"error_matrix_unet"</span>, error_matrix_unet.getInfo())</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"test_acc_unet"</span>, test_acc_unet.getInfo())</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"test_kappa_unet"</span>, test_kappa_unet.getInfo())</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"test_recall_producer_acc_unet"</span>, test_recall_producer_acc_unet.getInfo())</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"test_precision_consumer_acc_unet"</span>, test_precision_consumer_acc_unet.getInfo())</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"f1_unet"</span>, f1_unet.getInfo())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>error_matrix_unet [[1191, 29], [33, 50]]
test_acc_unet 0.9524174980813507
test_kappa_unet 0.5919321924312524
test_recall_producer_acc_unet 0.6024096385542169
test_precision_consumer_acc_unet 0.6329113924050633
f1_unet 0.6172839506172839</code></pre>
</div>
</div>
</section>
<section id="calculate-probability-distribution" class="level4" data-number="3.5.5.3">
<h4 data-number="3.5.5.3" class="anchored" data-anchor-id="calculate-probability-distribution"><span class="header-section-number">3.5.5.3</span> Calculate Probability Distribution</h4>
<div id="cell-102" class="cell" data-outputid="28849e66-5a43-42c1-e3cf-0d75e394f28c">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>prob_output_unet <span class="op">=</span> UNET_RGBN.select([<span class="st">"prediction"</span>, <span class="st">"others_etc"</span>, <span class="st">"cropland_etc"</span>, <span class="st">"urban"</span>, <span class="st">"forest"</span>, <span class="st">"rice"</span>]) <span class="op">\</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>                            .rename([<span class="st">"prediction_class"</span>, <span class="st">"others_prob"</span>, <span class="st">"cropland_prob"</span>, <span class="st">"urban_prob"</span>, <span class="st">"forest_prob"</span>, <span class="st">"rice_prob"</span>]) <span class="op">\</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                            .sampleRegions(collection<span class="op">=</span>ceo_final_data, scale<span class="op">=</span><span class="dv">10</span>, geometries<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print("prob_output_unet", prob_output_unet.getInfo())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-103" class="cell" data-outputid="856e045e-264f-469a-8d3c-39fe889fc676">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>prob_output_unet <span class="op">=</span> prob_output_unet.getInfo()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
</section>
</section>
<section id="model-dnn" class="level3" data-number="3.5.6">
<h3 data-number="3.5.6" class="anchored" data-anchor-id="model-dnn"><span class="header-section-number">3.5.6</span> Model: DNN</h3>
<section id="load-and-visualize-the-prediction-output-1" class="level4" data-number="3.5.6.1">
<h4 data-number="3.5.6.1" class="anchored" data-anchor-id="load-and-visualize-the-prediction-output-1"><span class="header-section-number">3.5.6.1</span> Load and visualize the prediction output</h4>
<div id="cell-106" class="cell" data-outputid="c1596c35-ee83-4d60-f7ec-df12eb68f9b6">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>DNN_RGBN <span class="op">=</span> ee.Image(<span class="st">"projects/servir-ee/assets/dl-book/chapter-1/prediction/prediction_dnn_v1"</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>DNN_RGBN <span class="op">=</span> DNN_RGBN.updateMask(rice_zone)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>Map.centerObject(DNN_RGBN)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>Map.addLayer(DNN_RGBN.clip(paro), {<span class="st">"bands"</span>: [<span class="st">"prediction"</span>], <span class="st">"min"</span>:<span class="dv">0</span>, <span class="st">"max"</span>:<span class="dv">4</span>, <span class="st">"palette"</span>: [<span class="st">"FFFF00"</span>, <span class="st">"FFC0CB"</span>, <span class="st">"267300"</span>, <span class="st">"E60000"</span>, <span class="st">"005CE6"</span>]}, <span class="st">"DNN_RGBN"</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>Map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e62f4972a04047768315ec5337734964","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</section>
<section id="calculate-classification-metrics-1" class="level4" data-number="3.5.6.2">
<h4 data-number="3.5.6.2" class="anchored" data-anchor-id="calculate-classification-metrics-1"><span class="header-section-number">3.5.6.2</span> Calculate classification metrics</h4>
<div id="cell-108" class="cell" data-outputid="4664a7c0-7bb8-4b93-b701-ae6325c68dd1">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>DNN_RGBN_remapped <span class="op">=</span> DNN_RGBN.remap([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>], <span class="dv">0</span>, <span class="st">"prediction"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>Map.addLayer(DNN_RGBN_remapped, {<span class="st">"min"</span>: <span class="dv">0</span>, <span class="st">"max"</span>: <span class="dv">1</span>, <span class="st">"palette"</span>: [<span class="st">"cfcf00"</span>, <span class="st">"267300"</span>]}, <span class="st">"DNN_RGBN_remapped"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>Map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"e62f4972a04047768315ec5337734964","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div id="cell-109" class="cell" data-outputid="0997cfa1-e5e3-493d-f879-097db0c61e5e">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>prediction_dnn <span class="op">=</span> DNN_RGBN_remapped.sampleRegions(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    collection <span class="op">=</span> ceo_final_data,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    scale <span class="op">=</span> <span class="dv">10</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    geometries <span class="op">=</span> <span class="va">True</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print("predictionOutputDNN", prediction_dnn.getInfo())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-110" class="cell" data-outputid="4fc4e8b3-0d83-43ac-d69e-e3e5f7354f06">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>error_matrix_dnn <span class="op">=</span> prediction_dnn.errorMatrix(actual<span class="op">=</span><span class="st">"rice"</span>, predicted<span class="op">=</span><span class="st">"remapped"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>test_acc_dnn <span class="op">=</span> error_matrix_dnn.accuracy()</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>test_kappa_dnn <span class="op">=</span> error_matrix_dnn.kappa()</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>test_recall_producer_acc_dnn <span class="op">=</span> error_matrix_dnn.producersAccuracy().get([<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>test_precision_consumer_acc_dnn <span class="op">=</span> error_matrix_dnn.consumersAccuracy().get([<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>f1_dnn <span class="op">=</span> error_matrix_dnn.fscore().get([<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-111" class="cell" data-outputid="68fcb3ce-9505-4fff-8ec6-54af9f063403">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"error_matrix_dnn"</span>, error_matrix_dnn.getInfo())</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"test_acc_dnn"</span>, test_acc_dnn.getInfo())</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"test_kappa_dnn"</span>, test_kappa_dnn.getInfo())</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"test_recall_producer_acc_dnn"</span>, test_recall_producer_acc_dnn.getInfo())</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"test_precision_consumer_acc_dnn"</span>, test_precision_consumer_acc_dnn.getInfo())</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"f1_dnn"</span>, f1_dnn.getInfo())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-stdout">
<pre><code>error_matrix_dnn [[1175, 45], [20, 63]]
test_acc_dnn 0.9501151189562548
test_kappa_dnn 0.6332676611314382
test_recall_producer_acc_dnn 0.7590361445783133
test_precision_consumer_acc_dnn 0.5833333333333334
f1_dnn 0.6596858638743456</code></pre>
</div>
</div>
</section>
<section id="calculate-probability-distribution-1" class="level4" data-number="3.5.6.3">
<h4 data-number="3.5.6.3" class="anchored" data-anchor-id="calculate-probability-distribution-1"><span class="header-section-number">3.5.6.3</span> Calculate Probability Distribution</h4>
<div id="cell-113" class="cell" data-outputid="ccb621ca-9399-4076-b1b7-4b54561661c7">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>prob_output_dnn <span class="op">=</span> DNN_RGBN.select([<span class="st">"prediction"</span>, <span class="st">"others_etc"</span>, <span class="st">"cropland_etc"</span>, <span class="st">"urban"</span>, <span class="st">"forest"</span>, <span class="st">"rice"</span>]) <span class="op">\</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>                            .rename([<span class="st">"prediction_class"</span>, <span class="st">"others_prob"</span>, <span class="st">"cropland_prob"</span>, <span class="st">"urban_prob"</span>, <span class="st">"forest_prob"</span>, <span class="st">"rice_prob"</span>]) <span class="op">\</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>                            .sampleRegions(collection<span class="op">=</span>ceo_final_data, scale<span class="op">=</span><span class="dv">10</span>, geometries<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="co"># print("prob_output_dnn", prob_output_dnn.getInfo())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-114" class="cell" data-outputid="3a301b2e-0119-4596-a6c9-184265c2ea6d">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>prob_output_dnn <span class="op">=</span> prob_output_dnn.getInfo()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
</section>
</section>
</section>
<section id="figures-and-plots" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="figures-and-plots"><span class="header-section-number">3.6</span> Figures and Plots</h2>
<section id="training-and-validation-plot" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="training-and-validation-plot"><span class="header-section-number">3.6.1</span> Training and Validation Plot</h3>
<div id="cell-117" class="cell" data-outputid="9b652d89-cd4f-4534-f70c-a05ef4fc9598">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-118" class="cell" data-outputid="3f5a9530-1c81-432b-8575-f84216deda6c">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(unet_config.MODEL_DIR <span class="op">/</span> <span class="st">"model.pkl"</span>, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    unet_model_metrics <span class="op">=</span> pickle.load(f)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(dnn_config.MODEL_DIR <span class="op">/</span> <span class="st">"model.pkl"</span>, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    dnn_model_metrics <span class="op">=</span> pickle.load(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-119" class="cell" data-outputid="0be4b0c6-01ad-4f2a-915b-31ac6a7ef95d">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subplots for different metrics in a 3x4 grid</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">4</span><span class="op">*</span><span class="dv">7</span>, <span class="dv">6</span><span class="op">*</span><span class="dv">2</span>))</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">"#1f77b4"</span>, <span class="st">"#ff7f0e"</span>, <span class="st">"#2ca02c"</span>, <span class="st">"#d62728"</span>]</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> [<span class="st">"loss"</span>, <span class="st">"precision"</span>, <span class="st">"recall"</span>, <span class="st">"categorical_accuracy"</span>]</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>metrics_name <span class="op">=</span> [<span class="st">"Loss"</span>, <span class="st">"Precision"</span>, <span class="st">"Recall"</span>, <span class="st">"Categorical Accuracy"</span>]</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, config.EPOCHS <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>title_fontsize <span class="op">=</span> <span class="dv">22</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>label_fontsize <span class="op">=</span> <span class="dv">22</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>legend_fontsize <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>tick_fontsize <span class="op">=</span> <span class="dv">18</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>lw<span class="op">=</span><span class="fl">1.5</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>):</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(metrics)):</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> i <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>            axs[i][y].plot(epochs, unet_model_metrics[<span class="ss">f"val_</span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>], color<span class="op">=</span>colors[<span class="dv">0</span>], marker<span class="op">=</span><span class="st">"o"</span>, lw<span class="op">=</span>lw, label<span class="op">=</span><span class="ss">f"U-Net validate </span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>            axs[i][y].plot(epochs, dnn_model_metrics[<span class="ss">f"val_</span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>], color<span class="op">=</span>colors[<span class="dv">1</span>], lw<span class="op">=</span>lw, marker<span class="op">=</span><span class="st">"o"</span>, label<span class="op">=</span><span class="ss">f"DNN validate </span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>            axs[i][y].set_title(<span class="ss">f"Validate </span><span class="sc">{</span>metrics_name[y]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span>title_fontsize)</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>            axs[i][y].set_xlabel(<span class="st">"epochs"</span>, fontsize<span class="op">=</span>label_fontsize)</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>            axs[i][y].set_ylabel(<span class="ss">f"</span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span>label_fontsize)</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>            axs[i][y].grid(linestyle<span class="op">=</span><span class="st">"dotted"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>            axs[i][y].legend(fontsize<span class="op">=</span>legend_fontsize)</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>            axs[i][y].tick_params(axis<span class="op">=</span><span class="st">"both"</span>, which<span class="op">=</span><span class="st">"major"</span>, labelsize<span class="op">=</span>tick_fontsize)</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>            axs[i][y].plot(epochs, unet_model_metrics[metrics[y]], color<span class="op">=</span>colors[<span class="dv">0</span>], lw<span class="op">=</span>lw, marker<span class="op">=</span><span class="st">"o"</span>, label<span class="op">=</span><span class="ss">f"U-Net train </span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>            axs[i][y].plot(epochs, dnn_model_metrics[metrics[y]], color<span class="op">=</span>colors[<span class="dv">1</span>], lw<span class="op">=</span>lw, marker<span class="op">=</span><span class="st">"o"</span>, label<span class="op">=</span><span class="ss">f"DNN train </span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>            axs[i][y].set_title(<span class="ss">f"Train </span><span class="sc">{</span>metrics_name[y]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span>title_fontsize)</span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>            axs[i][y].set_xlabel(<span class="st">"epochs"</span>, fontsize<span class="op">=</span>label_fontsize)</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>            axs[i][y].set_ylabel(<span class="ss">f"</span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span>label_fontsize)</span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>            axs[i][y].grid(linestyle<span class="op">=</span><span class="st">"dotted"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>            axs[i][y].legend(fontsize<span class="op">=</span>legend_fontsize)</span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>            axs[i][y].tick_params(axis<span class="op">=</span><span class="st">"both"</span>, which<span class="op">=</span><span class="st">"major"</span>, labelsize<span class="op">=</span>tick_fontsize)</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout and show the plot</span></span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig("metrics_plot_model_comparison.png", dpi=500, bbox_inches="tight")</span></span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Rice_Mapping_Bhutan_2021_files/figure-html/cell-60-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-120" class="cell" data-outputid="12836c8b-749c-4d9f-bbde-51b66ed651d0">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subplots for different metrics in a 3x4 grid</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">4</span><span class="op">*</span><span class="dv">7</span>, <span class="dv">6</span><span class="op">*</span><span class="dv">1</span>))</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">"#1f77b4"</span>, <span class="st">"#ff7f0e"</span>, <span class="st">"#2ca02c"</span>, <span class="st">"#d62728"</span>]</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> [<span class="st">"loss"</span>, <span class="st">"precision"</span>, <span class="st">"recall"</span>, <span class="st">"categorical_accuracy"</span>]</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>metrics_name <span class="op">=</span> [<span class="st">"Loss"</span>, <span class="st">"Precision"</span>, <span class="st">"Recall"</span>, <span class="st">"Categorical Accuracy"</span>]</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, config.EPOCHS <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>title_fontsize <span class="op">=</span> <span class="dv">22</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>label_fontsize <span class="op">=</span> <span class="dv">22</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>legend_fontsize <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>tick_fontsize <span class="op">=</span> <span class="dv">18</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>lw<span class="op">=</span><span class="fl">1.5</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> y <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(metrics)):</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>    axs[y].plot(epochs, unet_model_metrics[<span class="ss">f"val_</span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>], color<span class="op">=</span>colors[<span class="dv">0</span>], marker<span class="op">=</span><span class="st">"o"</span>, lw<span class="op">=</span>lw, label<span class="op">=</span><span class="ss">f"U-Net validate </span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>    axs[y].plot(epochs, dnn_model_metrics[<span class="ss">f"val_</span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>], color<span class="op">=</span>colors[<span class="dv">1</span>], lw<span class="op">=</span>lw, marker<span class="op">=</span><span class="st">"o"</span>, label<span class="op">=</span><span class="ss">f"DNN validate </span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>    axs[y].plot(epochs, unet_model_metrics[metrics[y]], color<span class="op">=</span>colors[<span class="dv">2</span>], lw<span class="op">=</span>lw, marker<span class="op">=</span><span class="st">"o"</span>, label<span class="op">=</span><span class="ss">f"U-Net train </span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>    axs[y].plot(epochs, dnn_model_metrics[metrics[y]], color<span class="op">=</span>colors[<span class="dv">3</span>], lw<span class="op">=</span>lw, marker<span class="op">=</span><span class="st">"o"</span>, label<span class="op">=</span><span class="ss">f"DNN train </span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>    axs[y].set_title(<span class="ss">f"</span><span class="sc">{</span>metrics_name[y]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span>title_fontsize)</span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>    axs[y].set_xlabel(<span class="st">"epochs"</span>, fontsize<span class="op">=</span>label_fontsize)</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>    axs[y].set_ylabel(<span class="ss">f"</span><span class="sc">{</span>metrics[y]<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span>label_fontsize)</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>    axs[y].grid(linestyle<span class="op">=</span><span class="st">"dotted"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>    axs[y].legend(fontsize<span class="op">=</span>legend_fontsize)</span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>    axs[y].tick_params(axis<span class="op">=</span><span class="st">"both"</span>, which<span class="op">=</span><span class="st">"major"</span>, labelsize<span class="op">=</span>tick_fontsize)</span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust layout and show the plot</span></span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.savefig("metrics_plot_model_comparison.png", dpi=500, bbox_inches="tight")</span></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Rice_Mapping_Bhutan_2021_files/figure-html/cell-61-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="probability-distribution-plot" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="probability-distribution-plot"><span class="header-section-number">3.6.2</span> Probability Distribution Plot</h3>
<div id="cell-122" class="cell" data-outputid="f36044bf-95c6-42b0-924a-79f84e71a903">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> {}</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>unet_data <span class="op">=</span> []</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>dnn_data <span class="op">=</span> []</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>unet_rice_data <span class="op">=</span> []</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>dnn_rice_data <span class="op">=</span> []</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>unet_other_data <span class="op">=</span> []</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>dnn_other_data <span class="op">=</span> []</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, feature <span class="kw">in</span> <span class="bu">enumerate</span>(prob_output_unet[<span class="st">"features"</span>]):</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>    unet_rice_prob <span class="op">=</span> <span class="bu">round</span>(feature[<span class="st">"properties"</span>][<span class="st">"rice_prob"</span>], <span class="dv">5</span>)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>    unet_other_prob <span class="op">=</span> <span class="bu">round</span>(feature[<span class="st">"properties"</span>][<span class="st">"cropland_prob"</span>] <span class="op">+</span> <span class="bu">round</span>(feature[<span class="st">"properties"</span>][<span class="st">"forest_prob"</span>] <span class="op">+</span> feature[<span class="st">"properties"</span>][<span class="st">"others_prob"</span>]<span class="op">+</span> feature[<span class="st">"properties"</span>][<span class="st">"urban_prob"</span>]), <span class="dv">5</span>)</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>    unet_data.append([unet_rice_prob, unet_other_prob])</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>    unet_rice_data.append(unet_rice_prob)</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>    unet_other_data.append(unet_other_prob)</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    dnn_feature <span class="op">=</span> prob_output_dnn[<span class="st">"features"</span>][i]</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>    dnn_rice_prob <span class="op">=</span> <span class="bu">round</span>(dnn_feature[<span class="st">"properties"</span>][<span class="st">"rice_prob"</span>], <span class="dv">5</span>)</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>    dnn_other_prob <span class="op">=</span> <span class="fl">1.</span> <span class="op">-</span> <span class="bu">round</span>(dnn_feature[<span class="st">"properties"</span>][<span class="st">"rice_prob"</span>], <span class="dv">5</span>)</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dnn_other_prob = round(dnn_feature["properties"]["cropland_prob"] + dnn_feature["properties"]["forest_prob"] + dnn_feature["properties"]["others_prob"]+ dnn_feature["properties"]["urban_prob"], 5)</span></span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    dnn_data.append([dnn_rice_prob, dnn_other_prob])</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    dnn_rice_data.append(dnn_rice_prob)</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>    dnn_other_data.append(dnn_other_prob)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
</div>
<div id="cell-123" class="cell" data-outputid="7663f08a-4787-4b96-d39f-5367654d8bce">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>title_fontsize <span class="op">=</span> <span class="dv">22</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>label_fontsize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>tick_fontsize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rectangular box plot</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>bplot1 <span class="op">=</span> ax1.boxplot([unet_rice_data, dnn_rice_data],</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>                     notch<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>                     vert<span class="op">=</span><span class="va">True</span>,  <span class="co"># vertical box alignment</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>                     patch_artist<span class="op">=</span><span class="va">True</span>,  <span class="co"># fill with color</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>                     labels<span class="op">=</span>[<span class="st">"U-Net"</span>, <span class="st">"DNN"</span>],</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>                     sym<span class="op">=</span><span class="st">"k+"</span>)  <span class="co"># will be used to label x-ticks</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">"Rice Probability"</span>)</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="co"># notch shape box plot</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>bplot2 <span class="op">=</span> ax2.boxplot([unet_other_data, dnn_other_data],</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>                     notch<span class="op">=</span><span class="va">True</span>,  <span class="co"># notch shape</span></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>                     vert<span class="op">=</span><span class="va">True</span>,  <span class="co"># vertical box alignment</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>                     patch_artist<span class="op">=</span><span class="va">True</span>,  <span class="co"># fill with color</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>                     labels<span class="op">=</span>[<span class="st">"U-Net"</span>, <span class="st">"DNN"</span>],</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>                     sym<span class="op">=</span><span class="st">"k+"</span>)  <span class="co"># will be used to label x-ticks</span></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">"Other Probability"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

            <style>
                .geemap-dark {
                    --jp-widgets-color: white;
                    --jp-widgets-label-color: white;
                    --jp-ui-font-color1: white;
                    --jp-layout-color2: #454545;
                    background-color: #383838;
                }

                .geemap-dark .jupyter-button {
                    --jp-layout-color3: #383838;
                }

                .geemap-colab {
                    background-color: var(--colab-primary-surface-color, white);
                }

                .geemap-colab .jupyter-button {
                    --jp-layout-color3: var(--colab-primary-surface-color, white);
                }
            </style>
            
</div>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>Text(0.5, 1.0, 'Other Probability')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Rice_Mapping_Bhutan_2021_files/figure-html/cell-63-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"007108c5cc4d44b1858db778d89c2d97":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"VBoxModel","state":{"_dom_classes":["geemap-colab"],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"VBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"VBoxView","box_style":"","children":["IPY_MODEL_ae7ad206d56c46838b9da14f696f3567"],"layout":"IPY_MODEL_dd4d5f7c794948d2a4654e874188b75a"}},"0d366aa12bdd46f6ab4d1889b35a4de8":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletAttributionControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletAttributionControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletAttributionControlView","options":["position","prefix"],"position":"bottomright","prefix":"ipyleaflet"}},"2063bf44aa46462bb1b1da736abad607":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletTileLayerView","attribution":"Google Earth Engine","base":false,"bottom":true,"bounds":null,"detect_retina":false,"loading":false,"max_native_zoom":null,"max_zoom":24,"min_native_zoom":null,"min_zoom":0,"name":"UNET_RGBN","no_wrap":false,"opacity":1,"options":["attribution","bounds","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms","zoom_offset"],"pane":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"subitems":[],"tile_size":256,"tms":false,"url":"https://earthengine-highvolume.googleapis.com/v1/projects/servir-ee/maps/53af541b31bb22254b96632345a87c86-702cdb20433f3397c647c7cb033fb9d2/tiles/{z}/{x}/{y}","visible":true,"zoom_offset":0}},"290f0fd585f1428d8c55ebc1fde3bf06":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletTileLayerView","attribution":"Google Earth Engine","base":false,"bottom":true,"bounds":null,"detect_retina":false,"loading":false,"max_native_zoom":null,"max_zoom":24,"min_native_zoom":null,"min_zoom":0,"name":"DNN_RGBN_remapped","no_wrap":false,"opacity":1,"options":["attribution","bounds","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms","zoom_offset"],"pane":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"subitems":[],"tile_size":256,"tms":false,"url":"https://earthengine-highvolume.googleapis.com/v1/projects/servir-ee/maps/90baf3aab17422934870b3b3529d87ff-b334264fbdf3fdc3e61da78e28ee7da8/tiles/{z}/{x}/{y}","visible":true,"zoom_offset":0}},"2a1e424ea9f7414699936b1853b0d6d1":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletZoomControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletZoomControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletZoomControlView","options":["position","zoom_in_text","zoom_in_title","zoom_out_text","zoom_out_title"],"position":"topleft","zoom_in_text":"+","zoom_in_title":"Zoom in","zoom_out_text":"-","zoom_out_title":"Zoom out"}},"2fb2b33622424835b41f36d7cc170d66":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletWidgetControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletWidgetControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletWidgetControlView","max_height":null,"max_width":null,"min_height":null,"min_width":null,"options":["position","transparent_bg"],"position":"topleft","transparent_bg":false,"widget":"IPY_MODEL_41fbc94481334b53aa9d273153e968ce"}},"305f6d03c8f8463ea06314f7cec9d0d2":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":"600px","justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"35ce835d00f149159d26e7e5771501e4":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletTileLayerView","attribution":"&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors","base":true,"bottom":true,"bounds":null,"detect_retina":false,"loading":false,"max_native_zoom":null,"max_zoom":19,"min_native_zoom":null,"min_zoom":1,"name":"OpenStreetMap.Mapnik","no_wrap":false,"opacity":1,"options":["attribution","bounds","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms","zoom_offset"],"pane":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"subitems":[],"tile_size":256,"tms":false,"url":"https://tile.openstreetmap.org/{z}/{x}/{y}.png","visible":true,"zoom_offset":0}},"41fbc94481334b53aa9d273153e968ce":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"HBoxModel","state":{"_dom_classes":["geemap-colab"],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_7d003a3cb04b4b2a9842276d0298323c"],"layout":"IPY_MODEL_9b46d07f8b0f431dbc1060ee8f7152be"}},"4939b83e554145ff8ea0d4103a4a5272":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletFullScreenControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletFullScreenControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletFullScreenControlView","options":["position"],"position":"topleft"}},"4f6431f6464c452eb09a360a1a416cb1":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"514da32ce49d44558374ba786ab3243f":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"grab"}},"6ae5113f023241cd8727c30349a0ddce":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletScaleControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletScaleControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletScaleControlView","imperial":true,"max_width":100,"metric":true,"options":["imperial","max_width","metric","position","update_when_idle"],"position":"bottomleft","update_when_idle":false}},"76e0789a1919471bbb9a7cd00102cea9":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"grab"}},"7d003a3cb04b4b2a9842276d0298323c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ToggleButtonModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ToggleButtonModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ToggleButtonView","button_style":"","description":"","description_tooltip":null,"disabled":false,"icon":"globe","layout":"IPY_MODEL_db680420a5904c4db54a9ae7be950532","style":"IPY_MODEL_abb314db1e324874a576f0bd5c9ffb4c","tooltip":"Search location/data","value":false}},"8cf5120154a045c4946815c1367f4f01":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletDrawControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletDrawControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletDrawControlView","circle":{},"circlemarker":{},"data":[],"edit":true,"marker":{"shapeOptions":{"color":"#3388ff"}},"options":["position"],"polygon":{"shapeOptions":{}},"polyline":{"shapeOptions":{}},"position":"topleft","rectangle":{"shapeOptions":{"color":"#3388ff"}},"remove":true}},"9b46d07f8b0f431dbc1060ee8f7152be":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9b67ac7d447a4ac2bb76fc3743008a69":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletWidgetControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletWidgetControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletWidgetControlView","max_height":null,"max_width":null,"min_height":null,"min_width":null,"options":["position","transparent_bg"],"position":"topright","transparent_bg":false,"widget":"IPY_MODEL_007108c5cc4d44b1858db778d89c2d97"}},"abb314db1e324874a576f0bd5c9ffb4c":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"DescriptionStyleModel","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"ac37d8d5482b4793bdbe85d07ca562f4":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletTileLayerView","attribution":"Google Earth Engine","base":false,"bottom":true,"bounds":null,"detect_retina":false,"loading":false,"max_native_zoom":null,"max_zoom":24,"min_native_zoom":null,"min_zoom":0,"name":"UNET_RGBN_remapped","no_wrap":false,"opacity":1,"options":["attribution","bounds","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms","zoom_offset"],"pane":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"subitems":[],"tile_size":256,"tms":false,"url":"https://earthengine-highvolume.googleapis.com/v1/projects/servir-ee/maps/60146f6ec655378bd9fbe5261371e565-8460d27274eaec0bcad803129a89ba29/tiles/{z}/{x}/{y}","visible":true,"zoom_offset":0}},"ae7ad206d56c46838b9da14f696f3567":{"model_module":"@jupyter-widgets/controls","model_module_version":"1.5.0","model_name":"ToggleButtonModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ToggleButtonModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ToggleButtonView","button_style":"","description":"","description_tooltip":null,"disabled":false,"icon":"wrench","layout":"IPY_MODEL_c08e8a0436df4f278ed0597177490a2d","style":"IPY_MODEL_4f6431f6464c452eb09a360a1a416cb1","tooltip":"Toolbar","value":false}},"b2ed3d00fa574dbab8b317bffd771696":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"move"}},"c08e8a0436df4f278ed0597177490a2d":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":"28px","justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":"0px 0px 0px 4px","right":null,"top":null,"visibility":null,"width":"28px"}},"ca1ef0c1db454c80846b3236d7a33bf5":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMeasureControlModel","state":{"_custom_units":{},"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMeasureControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletMeasureControlView","active_color":"orange","capture_z_index":10000,"completed_color":"#C8F2BE","options":["active_color","capture_z_index","completed_color","popup_options","position","primary_area_unit","primary_length_unit","secondary_area_unit","secondary_length_unit"],"popup_options":{"autoPanPadding":[10,10],"className":"leaflet-measure-resultpopup"},"position":"bottomleft","primary_area_unit":"acres","primary_length_unit":"kilometers","secondary_area_unit":null,"secondary_length_unit":null}},"db680420a5904c4db54a9ae7be950532":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":"28px","justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":"0px 0px 0px 4px","right":null,"top":null,"visibility":null,"width":"28px"}},"dd4d5f7c794948d2a4654e874188b75a":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e62f4972a04047768315ec5337734964":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletMapModel","state":{"_dom_classes":[],"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletMapModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletMapView","bottom":220961,"bounce_at_zoom_limits":true,"box_zoom":true,"center":[27.37845188654284,89.42005507220328],"close_popup_on_click":true,"controls":["IPY_MODEL_2fb2b33622424835b41f36d7cc170d66","IPY_MODEL_2a1e424ea9f7414699936b1853b0d6d1","IPY_MODEL_4939b83e554145ff8ea0d4103a4a5272","IPY_MODEL_8cf5120154a045c4946815c1367f4f01","IPY_MODEL_6ae5113f023241cd8727c30349a0ddce","IPY_MODEL_ca1ef0c1db454c80846b3236d7a33bf5","IPY_MODEL_9b67ac7d447a4ac2bb76fc3743008a69","IPY_MODEL_0d366aa12bdd46f6ab4d1889b35a4de8"],"crs":{"custom":false,"name":"EPSG3857"},"default_style":"IPY_MODEL_514da32ce49d44558374ba786ab3243f","double_click_zoom":true,"dragging":true,"dragging_style":"IPY_MODEL_b2ed3d00fa574dbab8b317bffd771696","east":90.06866455078126,"fullscreen":false,"inertia":true,"inertia_deceleration":3000,"inertia_max_speed":1500,"interpolation":"bilinear","keyboard":true,"keyboard_pan_offset":80,"keyboard_zoom_offset":1,"layers":["IPY_MODEL_35ce835d00f149159d26e7e5771501e4","IPY_MODEL_2063bf44aa46462bb1b1da736abad607","IPY_MODEL_ac37d8d5482b4793bdbe85d07ca562f4","IPY_MODEL_f8f7124bab224742ad4404ed7ac2f122","IPY_MODEL_290f0fd585f1428d8c55ebc1fde3bf06"],"layout":"IPY_MODEL_305f6d03c8f8463ea06314f7cec9d0d2","left":391427,"max_zoom":24,"min_zoom":null,"modisdate":"2024-04-22","north":27.561243062320802,"options":["bounce_at_zoom_limits","box_zoom","center","close_popup_on_click","double_click_zoom","dragging","fullscreen","inertia","inertia_deceleration","inertia_max_speed","interpolation","keyboard","keyboard_pan_offset","keyboard_zoom_offset","max_zoom","min_zoom","prefer_canvas","scroll_wheel_zoom","tap","tap_tolerance","touch_zoom","world_copy_jump","zoom","zoom_animation_threshold","zoom_delta","zoom_snap"],"panes":{},"prefer_canvas":false,"right":393316,"scroll_wheel_zoom":true,"south":27.195403645911856,"style":"IPY_MODEL_514da32ce49d44558374ba786ab3243f","tap":true,"tap_tolerance":15,"top":220361,"touch_zoom":true,"west":88.77159118652344,"window_url":"https://jtv6rig0v1-496ff2e9c6d22116-0-colab.googleusercontent.com/outputframe.html?vrz=colab_20240419-060117_RC00_626297502","world_copy_jump":false,"zoom":11,"zoom_animation_threshold":4,"zoom_delta":1,"zoom_snap":1}},"f8f7124bab224742ad4404ed7ac2f122":{"model_module":"jupyter-leaflet","model_module_version":"^0.18","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.18","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.18","_view_name":"LeafletTileLayerView","attribution":"Google Earth Engine","base":false,"bottom":true,"bounds":null,"detect_retina":false,"loading":false,"max_native_zoom":null,"max_zoom":24,"min_native_zoom":null,"min_zoom":0,"name":"DNN_RGBN","no_wrap":false,"opacity":1,"options":["attribution","bounds","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms","zoom_offset"],"pane":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"subitems":[],"tile_size":256,"tms":false,"url":"https://earthengine-highvolume.googleapis.com/v1/projects/servir-ee/maps/e1fbfdc69c003fdf85fbf47e33899357-a2f3e58fa63674709c97381a903f234b/tiles/{z}/{x}/{y}","visible":true,"zoom_offset":0}}}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../02-Data-Preparation/index.html" class="pagination-link" aria-label="Data Preparation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Preparation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../04_Object_Detection/index.html" class="pagination-link" aria-label="Object Detection">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Object Detection</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>